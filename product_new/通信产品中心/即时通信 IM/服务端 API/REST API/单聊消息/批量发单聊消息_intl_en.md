## Feature Description
- This API can send one-to-one messages to up to 500 users at a time.
- Compared with the one-to-one message API, this API is more suitable for time-sensitive messages, such as marketing messages and system notifications.
- When the admin specifies an account to send messages to target accounts in batches, receivers will see the account specified by the admin instead of the admin account.
- This API does not trigger callback requests.
- This API does not check the relationship between the sender and receiver (including blacklists) or check whether the receiver is muted.

> When the server-end integrated RESTful API is used to send messages in batches, you can determine whether to synchronize the messages to the sender (the admin account or the account specified by the admin). The synchronization methods include synchronizing through online terminals and the roaming server. The RESTful API provides the SyncOtherMachine parameter to determine whether to synchronize the messages. For details, see "Request packet example" below.

## API Invocation Description
### Request URL example
```
https://console.tim.qq.com/v4/openim/batchsendmsg?sdkappid=88888888&identifier=admin&usersig=xxx&random=99999999&contenttype=json
```
### Request parameters

The following table describes only the parameters that are modified when this API is invoked. For details on other parameters, see [RESTful API Overview](https://intl.cloud.tencent.com/document/product/1047/34620).

| Parameter | Description |
| ------------------ | ------------------------------------ |
| v4/openim/batchsendmsg | Request API |
| sdkappid | SDKAppID assigned by the IM console when an app is created |
| identifier | It must be an app admin account. For details, see [App Admins](https://intl.cloud.tencent.com/document/product/1047/33517#app-.E7.AE.A1.E7.90.86.E5.91.98). |
| usersig | The signature generated by the app admin account. For details, see [Generating UserSig](https://intl.cloud.tencent.com/document/product/1047/34385). |
| random | Enter a random 32-bit unsigned integer ranging from 0 to 4294967295. |

### Maximum invocation frequency

The maximum invocation frequency is 200 times per second.

### Request packet example
The following uses sending text messages as an example. To send another type of messages, set **MsgBody** to the corresponding message type. For details, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527).

#### Sending messages to target accounts in batches by the admin

> If you do not want to synchronize messages to From_Account, set SyncOtherMachine to 2.
> To synchronize messages to From_Account, set SyncOtherMachine to 1.

```
{
    "SyncOtherMachine": 2, // Do not synchronize messages to the sender.
    "To_Account": [ // List of target accounts
        "bonnie",
        "rong"
    ],
    "MsgRandom": 19901224, // Message random number
    "MsgBody": [ // Message body
        {
            "MsgType": "TIMTextElem", // Specify the message type. TIMTextElem indicates the text message type.
            "MsgContent": {
                "Text": "hi, beauty" // Message text
            }
        }
    ]
}
```

#### Specifying an account to send messages to target accounts in batches and configuring offline message push by the admin
From_Account indicates the sender specified by the admin. Receivers will see From_Account instead of the admin account. The following JSON example request indicates that dave sends a message to the bonnie and rong accounts. When bonnie and rong receive the message, they find that the message sender is dave.
> If you do not want to synchronize messages to From_Account, set SyncOtherMachine to 2.
> To synchronize messages to From_Account, set SyncOtherMachine to 1.

```
{
    "SyncOtherMachine": 1, // Synchronize messages to the sender.
    "From_Account": "dave",
    "To_Account": [
        "bonnie",
        "rong"
    ],
    "MsgRandom": 19901224,
    "MsgBody": [
        {
            "MsgType": "TIMTextElem",
            "MsgContent": {
                "Text": "hi, beauty"
            }
        }
    ],
    "OfflinePushInfo": {
        "PushFlag": 0,
        "Desc": "Offline push content",
        "Ext": "Passthrough content",
        "AndroidInfo": {
            "Sound": "android.mp3"
        },
        "ApnsInfo": {
            "Sound": "apns.mp3",
            "BadgeMode": 1, // The default value of this field is 0, indicating that a message is counted. The value 1 indicates that the message is not counted, that is, the number in the upper-right corner of the icon does not increment.
            "Title":"apns title", // apns title
            "SubTitle":"apns subtitle", // apns subtitle
            "Image":"www.image.com" // image url
        }
    }
}
```

### Request packet fields

| Field | Type | Attribute | Description |
|---------|---------|---------|---------|
| SyncOtherMachine | Integer | Optional | 1: synchronize messages to the From_Account online terminals and roaming server. <br/>2: do not synchronize messages to From_Account. If this parameter is not specified, messages are synchronized to the From_Account roaming server by default. |
| From_Account | String | Optional | The sender account specified by the admin. (To set From_Account information, this parameter must be specified.) |
| To_Account | Array | Required | The identifiers of  message receivers. |
| MsgRandom | Integer | Required | The message random number, which is generated by the random function and used to locate issues at the backend. |
| MsgBody | Object | Required | The TIM message. For details, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527). |
| MsgType | String | Required | The TIM message object type. Supported message objects are TIMTextElem (text message), TIMFaceElem (emoji message), TIMLocationElem (location message), and TIMCustomElem (custom message). |
| MsgContent | Object | Required | The TIM message object. For details, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527). |
| OfflinePushInfo | Object | Optional | Offline push information. For details, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527). |



### Response packet examples

- Successful response packet example
```
 {
    "ErrorInfo": "",
    "ActionStatus": "OK",
    "ErrorCode": 0,
    "MsgKey": "128493_903762_1572870301"
}
```

- Failed response packet example
```
{
    "ActionStatus": "FAIL",
    "ErrorInfo": "",
    "ErrorList": [ // List of message sending failures
        {
            "To_Account": "rong", // Target account
            "ErrorCode":  90011 // Error code
        }
    ]
}
```

### Response packet fields

| Field | Type | Description |
|---------|---------|---------|
| ActionStatus | String | The request processing result. OK: succeeded. FAIL: failed. |
| ErrorList | Array | List of target accounts to which messages failed to be sent. If all messages are sent successfully, ErrorList is empty. To determine whether all messages were sent successfully, check whether ErrorList is included in the response packet. |
| To_Account | String | Accounts to which messages failed to be sent. |
| ErrorCode | Number | The error code for message sending failure |
| MsgKey | String | The unique message identifier, which is used to cancel a message. Its maximum length is 50 characters. |

## Error Codes

Unless a network error (such as error 502) occurs, the HTTP return code for this API is always 200. ErrorCode and ErrorInfo in the response packet represent the actual error code and error information, respectively.
For common error codes (60000 to 79999), see [Error Codes](https://intl.cloud.tencent.com/document/product/1047/34348).
The following table describes the error codes specific to this API.

| Error Code | Description |
| ------------- | ------------------------------------------------------------ |
| 90001 | Failed to parse the JSON request packet. In this case, check whether the request packet meets JSON specifications. |
| 90002 | MsgBody in the JSON request packet does not meet message format requirements, or the type of MsgBody is not Array. For details, see the definition of the [TIMMsgElement Object](https://intl.cloud.tencent.com/document/product/1047/33527#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement). |
| 90007 | The type of MsgBody in the JSON request packet is not Array. In this case, change the type to Array. |
| 90008 | The JSON request packet does not include From_Account, or From_Account does not exist. |
| 90009 | The request requires app admin permissions. |
| 90010 | The JSON request packet does not meet message format requirements. For details, see the definition of the [TIMMsgElement Object](https://intl.cloud.tencent.com/document/product/1047/33527#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement). |
| 90011 | The number of target accounts for receiving messages exceeds 500. In this case, reduce target accounts in To_Account. |
| 90012 | To_Account is not registered or does not exist. In this case, check whether To_Account has been imported to IM or is incorrectly spelled. |
| 90026 | The retaining period of offline messages is incorrect. The period cannot exceed seven days. |
| 90048 | The requested user account does not exist. |
| 90992 | An internal server error occurred. In this case, try again. If this error code is returned for all requests and the app has configured third-party callback, check whether the app server correctly sends the callback result to the IM backend server. |
| 91000 | An internal server error occurred. In this case, try again. |
| 93000 | The length of the JSON data packet exceeds the maximum length of 8 KB. |


## API Commissioning Tool
Use the [RESTful online commissioning tool for APIs](https://avc.cloud.tencent.com/im/APITester/APITester.html#v4/openim/batchsendmsg) to commission this API.

## References
- Sending a one-to-one chat message ([v4/openim/sendmsg](https://intl.cloud.tencent.com/document/product/1047/34919))
- Sending common messages in a group ([v4/group_open_http_svc/send_group_msg](https://intl.cloud.tencent.com/document/product/1047/34959))
- Sending system notifications in a group ([v4/group_open_http_svc/send_group_system_notification](https://intl.cloud.tencent.com/document/product/1047/34958))
- [Message format description](https://intl.cloud.tencent.com/document/product/1047/33527)
