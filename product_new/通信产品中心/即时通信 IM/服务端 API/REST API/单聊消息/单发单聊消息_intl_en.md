## Feature Description
- When the admin sends a message to an account, the recipient will find that the message sender is the admin.
- When the admin specifies an account to send a message to another account, the recipient will find that the sender is not the admin but the account specified by the admin.
- This API does not check whether the sender and the recipient are friends (nor check the blacklist) or whether the recipient is muted.

> When the server sends one-to-one chat messages through this RESTful API, you can choose whether to synchronize the messages to the sender (the admin account or another account specified by the admin). In this case, available synchronization methods are synchronizing through online terminals and through the roaming server. The RESTful API provides the **SyncOtherMachine** parameter to determine whether to synchronize the messages. For details, see "Request packet examples" below.

## API Invocation Description
### Request URL example
```
https://console.tim.qq.com/v4/openim/sendmsg?sdkappid=88888888&identifier=admin&usersig=xxx&random=99999999&contenttype=json
```
### Request parameters

The following table lists and describes only the parameters to be modified when this API is invoked. For details on other parameters, see [RESTful API Overview](https://intl.cloud.tencent.com/document/product/1047/34620).

| Parameter | Description |
| ------------------ | ------------------------------------ |
| v4/openim/sendmsg | The request API. |
| sdkappid | The SDKAppID assigned by the IM console when an app is created. |
| identifier | This must be the app admin account. For details, see [App Admins](https://intl.cloud.tencent.com/document/product/1047/33517#app-.E7.AE.A1.E7.90.86.E5.91.98). |
| usersig | The signature generated by the app admin account. For details, see [Generating UserSig](https://intl.cloud.tencent.com/document/product/1047/34385). |
| random | Enter a random 32-bit unsigned integer ranging from 0 to 4294967295. |

### Maximum invocation frequency

The maximum invocation frequency is 200 times per second.

### Request packet examples
Here, we use sending text messages as an example. To send messages of other types, set **MsgBody** to the corresponding message type. For details, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527).

#### Sending messages to another account by the admin

> If you do not want to synchronize messages to From_Account, set SyncOtherMachine to 2.
> To synchronize messages to From_Account, set SyncOtherMachine to 1.

```
{
    "SyncOtherMachine": 2, // Messages are not synchronized to the sender.
    "To_Account": "lumotuwe2",
    "MsgLifeTime":60, // Messages are retained for 60 seconds.
    "MsgRandom": 1287657,
    "MsgTimeStamp": 1557387418,
    "MsgBody": [
        {
            "MsgType": "TIMTextElem",
            "MsgContent": {
                "Text": "hi, beauty"
            }
        }
    ]
}
```

#### Specifying an account to send messages to another account by the admin and enabling offline information push without synchronizing the messages to **From_Account**
> If you do not want to synchronize messages to From_Account, set SyncOtherMachine to 2.

```
{
    "SyncOtherMachine": 2,
    "From_Account": "lumotuwe1",
    "To_Account": "lumotuwe2",
    "MsgLifeTime":3600, // Messages are retained for one hour.
    "MsgRandom": 1287657,
    "MsgTimeStamp": 1557387418,
    "MsgBody": [
        {
            "MsgType": "TIMTextElem",
            "MsgContent": {
                "Text": "hi, beauty"
            }
        }
    ],
    "OfflinePushInfo": {
        "PushFlag": 0,
        "Desc": "Offline push content",
        "Ext": "This is the passthrough content",
        "AndroidInfo": {
            "Sound": "android.mp3"
        },
        "ApnsInfo": {
            "Sound": "apns.mp3",
            "BadgeMode": 1, // The default value of this field is 0, indicating that a message is counted. The 1 value indicates that the message is not counted, that is, the number in the upper-right corner of the icon does not increment.
            "Title":"apns title", // apns title
            "SubTitle":"apns subtitle", // apns subtitle
            "Image":"www.image.com" // image url
        }
    }
}
```

#### Specifying an account to send messages to another account by the admin and synchronizing the messages to From_Account
> To synchronize messages to From_Account, set SyncOtherMachine to 1.

```
{
    "SyncOtherMachine": 1, // Messages are synchronized to the sender.
    "From_Account": "lumotuwe1",
    "To_Account": "lumotuwe2",
    "MsgRandom": 1287657,
    "MsgTimeStamp": 1557387418,
    "MsgBody": [
        {
            "MsgType": "TIMTextElem",
            "MsgContent": {
                "Text": "hi, beauty"
            }
        }
    ]
}
```

### Request packet fields

| Field | Type | Attribute | Description |
|---------|---------|----|---------|
| SyncOtherMachine | Integer | Optional | 1: messages are synchronized to the From_Account online terminals and roaming server.<br/>2: messages are not synchronized to From_Account.<br/>If this parameter is not specified, messages are synchronized to the From_Account roaming server by default. |
| From_Account | String | Optional | The identifier of the message sender (for specifying the sender account). |
| To_Account | String | Required | The identifier of the message recipient. |
| MsgLifeTime | Integer | Optional | The retention period of offline message in seconds, which is 7 days (604,800 seconds) at the maximum. <li>If this field is set to 0, messages will be sent only to online users and not retained offline. </li><li>If this field is set to a period that is greater than 7 days (604,800 seconds), messages will be retained for only 7 days as normal. </li><li>If this field is not specified, messages will be retained for 7 days by default.</li> |
| MsgRandom | Integer | Required | The message random number, which is generated by the random function and used to locate issues at the backend. |
| MsgTimeStamp | Integer | Optional | The message timestamp in UNIX format (in seconds). |
| MsgBody | Object | Required | Message content. For details, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527). (Note: a single message can contain multiple message elements, with MsgBody set to Array.) |
| MsgType | String | Required | The TIM message object type. Supported message objects are TIMTextElem (text messages), TIMFaceElem (emoji messages), TIMLocationElem (location messages), and TIMCustomElem (custom messages). |
| MsgContent | Object | Required | Different MsgContent formats are used for different values of MsgType. For details, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527). |
| OfflinePushInfo | Object | Optional | Offline push information. For details, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527). |


### Response packet examples
- Normal response
```
{
    "ActionStatus": "OK", 
    "ErrorInfo": "", 
    "ErrorCode": 0, 
    "MsgTime": 1497238162,
    "MsgKey": "89541_2574206_1572870301"
}
```

- Abnormal response
```
{
    "ActionStatus": "FAIL", 
    "ErrorInfo": "Fail to Parse json data of body, Please check it", 
    "ErrorCode": 90001
}
```

### Response packet fields

| Field | Type | Description |
|---------|---------|---------|
| ActionStatus | String | Required | The request processing result. OK: succeeded. FAIL: failed. |
| ErrorCode | Integer | The error code. 0: succeeded. Others: failed. |
| ErrorInfo | String | Error information. |
| MsgTime | Integer | The message timestamp in UNIX format. |
| MsgKey | String | The unique message identifier for canceling a message. Its maximum length is 50 characters. |

## Error Codes

Unless a network error (such as error 502) occurs, the HTTP return code for this API is always 200. ErrorCode and ErrorInfo in the response packet represent the actual error code and error information, respectively.
For common error codes (60000 to 79999), see [Error Codes](https://intl.cloud.tencent.com/document/product/1047/34348).
The following table describes the error codes specific to this API.

| Error Code | Description |
| ------------- | ------------------------------------------------------------ |
| 20001 | The request packet is invalid. |
| 20002 | UserSig or A2 is invalid. |
| 20003 | The UserID of the sender or recipient is invalid or does not exist. In this case, check whether the UserID has been imported into IM. |
| 20004 | A network exception occurred. In this case, try again. |
| 20005 | An internal server error occurred. In this case, try again. |
| 20006 | The callback before sending a one-to-one chat message is triggered, and the app backend returns a response that forbids the message to be sent. |
| 20009 | The message cannot be sent because the sender and the recipient are not friends (this problem occurs only when friendship verification for one-to-one chat messages is enabled.) |
| 20010 | The one-to-one chat message cannot be sent to the target user because you are not the userâ€™s friend (one-way relationship). |
| 20011 | The one-to-one message cannot be sent to the target user because the user is not your friend (one-way relationship). |
| 20012 | The sender has been muted, and therefore the message cannot be sent. |
| 90001 | Failed to parse the JSON request packet. In this case, check whether the request packet meets JSON specifications. |
| 90002 | The MsgBody format in the JSON request packet does not meet message format requirements, or MsgBody is not set to Array. For details, see the definition of the [TIMMsgElement Object](https://intl.cloud.tencent.com/document/product/1047/33527#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement). |
| 90003 | The JSON request packet does not include the To_Account field or the To_Account field is not of the String type. |
| 90005 | The JSON request packet does not include the MsgRandom field or the MsgRandom field is not of the Integer type. |
| 90006 | The MsgTimeStamp field in the JSON request packet is not of the Integer type. |
| 90007 | MsgBody in the JSON request packet is not Array. In this case, change the type to Array. |
| 90009 | The request requires app admin permissions. |
| 90010 | The JSON request packet does not meet message format requirements. For details, see the definition of the [TIMMsgElement Object](https://intl.cloud.tencent.com/document/product/1047/33527#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement). |
| 90011 | The number of target accounts to which messages are sent exceeds 500. In this case, reduce the number of target accounts in To_Account. |
| 90012 | To_Account is not registered or does not exist. In this case, check whether To_Account has been imported into IM or is misspelled. |
| 90026 | The retention period of offline messages is invalid. The period cannot exceed 7 days. |
| 90031 | The SyncOtherMachine field in the JSON request packet is not of the Integer type. |
| 90044 | The MsgLifeTime field in the JSON request packet is not of the Integer type. |
| 91000 | An internal service error occurred. In this case, try again. |
| 90992 | An internal server error occurred. In this case, try again. If this error code is returned for all requests and the app has configured third-party callback, check whether the app server sends the callback result to the IM backend server normally. |
| 93000 | The JSON data packet exceeds the length limit of 8 KB. |
| 90048 | The requested user account does not exist. |

## API Commissioning Tool

Use the [online commissioning tool for RESTful APIs](https://avc.cloud.tencent.com/im/APITester/APITester.html#v4/openim/sendmsg) to commission this API.

## References
Sending one-to-one chat messages in batches ([v4/openim/batchsendmsg](https://intl.cloud.tencent.com/document/product/1047/34920))

## Callbacks That May Be Triggered

- [Callback before sending one-to-one chat messages](https://intl.cloud.tencent.com/document/product/1047/34364)
- [Callback after sending one-to-one chat messages](https://intl.cloud.tencent.com/document/product/1047/34365)
