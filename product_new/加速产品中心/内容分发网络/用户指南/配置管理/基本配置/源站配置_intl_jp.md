オリジンサーバーにモジュールを構成する時、ドメイン名のオリジンサーバー構成を変更できます。CDNは、下記のオリジンプルモードに対応します。
- マルチサイトアクティブIP
  複数のIPをオリジンサーバーとして構成する場合、オリジンプルはポーリングポリシーを使用し、ランダムで一つのIPを選んでオリジンプルする同時に、CDNはオリジンサーバーのパッシブ探知を行い、一定の時間において失敗率が急増したIPを検出した場合、自動的に該当IPを一定の時間内（デフォルトでは60s）にブロックします。ポーリングする時は、ブロックされているオリジンサーバーIPを無視します。
- ドメイン名のオリジンサーバー
  指定のドメイン名をオリジンサーバーに設定できます。オリジンサーバーに設定されたドメイン名は、加速ドメイン名と異なる必要があります。
- COS bucketオリジンサーバー
  既存のCOSバケットをオリジンプルのオリジンサーバーとして選択できます。COS V5バージョンのバケットのみに対応します。
- スレーブサイトの構成
  ユーザー保有のオリジンサーバードメイン名でホットバックアップオリジンサーバーを構成するをサポートします。マスターオリジンサーバーに対するオリジンプルリクエストにエラー（4XX、5XXエラーコードとTCP接続エラーを含む）が発生した場合は、直接ホットバックアップオリジンサーバーにオリジンプルします。ホットバックアップオリジンサーバーを構成することで、オリジンプルの失敗率を効果的に下げて、サービス品質を向上させることができます。ホットバックアップオリジンサーバーは現時点HTTPSオリジンプルに対応していないため、ホットバックアップオリジンサーバーのドメイン名を構成してから証明書を構成する場合は、HTTPSオリジンプルを選択しないでください。

>!
> - 変更できるオリジンサーバーは、ユーザー追加のドメイン名のオリジンサーバーのみです。[Cloud Object Storage](https://cloud.tencent.com/product/cos) 上の、Bucketによって自動的に作成された、拡張子がfile.myqcloud.comの加速ドメイン名のオリジンサーバーは変更できません。
> - 関係機関の規定によって、オリジンサーバーがTencent Cloud CVMの加速ドメイン名の場合、ホストヘッダー構成のドメイン名はTencent Cloudで登録する必要があります、登録しない場合、ブロックされる可能性があります。

## 構成ガイド

### 構成の確認

1. [CDNコンソール(https://console.cloud.tencent.com/cdn)にログインして、左側ディレクトリの【ドメイン名管理】をクリックし、管理ページに入ってから、リストで編集するドメイン名のある行を見つけて、アクションバーの【管理】をクリックします。
   ![img](https://main.qcloudimg.com/raw/99e0c24b4530c30b9abe27325bb1b317.png)
2. 「基本構成」ページには、**オリジンサーバー情報**モジュールがあります。そこでドメイン名の現在のオリジンサーバー構成を確認できます。
   ![img](https://main.qcloudimg.com/raw/4d03f386fd5a2e5c5290d037d3b2642f.png)

### オリジンサーバーの変更
「オリジンサーバー情報-マスターオリジンサーバー」の右上の【編集】アイコンをクリックして、マスターオリジンサーバーのオリジンサーバー種類とオリジンサーバーアドレスを変更できます。
![](https://main.qcloudimg.com/raw/21d2952e8ba021057b02ac9aaba45e14.png)

**ユーザー保有オリジンサーバー**：オリジンサーバーのアドレスは、複数のIPモードまたは一つのドメイン名モードに構成できます。指定ポートのオリジンプルに対応し、そのフォーマットは「ドメイン名:PORT/IP:PORT」であり、ポート値の範囲は0～65535です。
- オリジンサーバーアドレスがIPモードである場合、オリジンサーバーの重みを構成できます。そのフォーマットは「IP:PORT:WEIGHT」であり、重みの値の範囲は0～1000です。
	- 単独のオリジンサーバーは重みを設定できません。
	- オリジンサーバーが複数のIPである場合、一部のIPのみにオリジンプル重みを設定してはなりません。
	- オリジンサーバーがドメイン名フォーマットである場合は、重みを設定できません。オリジンサーバーがIPである場合にのみ、重みを設定できます。
	- 重みの構成フォーマットはIP:PORT:WEIGHTですが、そのうちのPORTを省略できます、フォーマットはIP::WEIGHTです。
	- 現在はIPv4アドレスの重み構成のみに対応しており、IPv6はまだ対応していません。

**COSオリジンサーバー**：COSバケットをオリジンサーバーとして指定します。

### スレーブサイトの追加

1. オリジンサーバーが【ユーザー保有】タイプのドメイン名に対しては、ホットバックアップオリジンサーバーの構成を追加できます。マスターオリジンサーバーに対するオリジンプルリクエストにエラー（4XX、5XXエラーコードとTCP接続エラーを含む）が発生した場合は、直接ホットバックアップオリジンサーバーにオリジンプルします。
   ![img](https://main.qcloudimg.com/raw/e54b5b7f5edcc70b4f9a6d410d5b367c.png)
2. スレーブサイトは、ユーザー保有のオリジンサーバーのみを追加できます。オリジンサーバーアドレスは複数のIPモード、または一つのドメイン名モードに構成できます。指定ポートのオリジンプルに対応し、ポート値の範囲は0～65535です。
   ![img](https://main.qcloudimg.com/raw/a433c625fa6c41075ad6c5a5ec7d5593.png)

### スレーブサイトの変更

スレーブサイトを追加したあとは、コンソールでワンクリックでマスター・スレーブの切替を実行でき、マスター／スレーブポリシーを調整でき、スレーブサイトを変更・削除できます。
![img](https://main.qcloudimg.com/raw/858e4ef4548539838ef4f8f6b5c2702a.png)

## 構成例
ユーザーリクエストの`http://www.test.com/1.jpg`はノードで命中しなかったため、オリジンサーバーに戻って取得します。
1. オリジンサーバーが下記のように構成されている場合：
![img](https://main.qcloudimg.com/raw/005664fb87eb93fe8ded14f8a6181e89.png)
   サーバー`1.1.1.1`に該当のリソースがないため、直接に404を返します。そこでオリジンプル層のCDNノードはresponseを受信してから、直接にリクエストクライアントに返します。ユーザーは該当の画像を取得できません。
2. オリジンサーバーが下記のように構成されている場合：
![img](https://main.qcloudimg.com/raw/fe043255636d48508e41a12b167c2ee2.png)
   サーバー`1.1.1.1`に該当のリソースがないため、直接に404を返します。そこでオリジンプル層のノードはresponseを受信してから、再びスレーブのオリジンサーバー`2.2.2.2`に該当のリソースをリクエストします。`2.2.2.2`から200が戻された場合、ノードは取得したコンテンツをリクエストクライアントに返します。ユーザーは画像を取得できます。
