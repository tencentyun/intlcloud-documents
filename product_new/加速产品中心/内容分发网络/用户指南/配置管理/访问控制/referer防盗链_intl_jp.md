サービスリソースにアクセスする源を制御しようとすると、CDNはreferer防犯リンク構成機能を提供します。ユーザーのHTTP Request Headerにおけるrefererフィールドの値にアクセス制御ポリシーを構成することにより、悪意のあるユーザーによる不正アクセスを回避するためのアクセス源を制限します。
## 構成ガイド

1. [CDNコンソール]（https://console.cloud.tencent.com/cdn）にログインし、左側のディレクトリの【ドメイン名管理】]をクリックすると、管理ページが表示されます。リストで編集するドメイン名の行を特定し、操作バーの【管理】をクリックします。
![img](https://main.qcloudimg.com/raw/99e0c24b4530c30b9abe27325bb1b317.png)
2. 【アクセス制御】タブをクリックし、防犯リンク構成モジュールで構成することができます。デフォルトでは、防犯リンクは無効になっており、ブラック/ホワイトリストはありません。
![img](https://main.qcloudimg.com/raw/56110bcf45df710945235bb7c08e5d29.png)
	refererブラックリストとホワイトリストには互換性がないので、同じ時間に一つのタイプしか発効できません。防犯リンクの入力内容は最大400件で、改行符で区切られ、1行に1個が入力されます。
	
>!
> - 防犯リンクはドメイン名/IPルールをサポートします。マッチングモードはプレフィックスマッチング（パスのみがサポートされている場合、ドメイン名のプレフィクスマッチングはサポートされていない）です。 即ち、構成リストが「www.abc.com」であると仮定すると、「www.abc.com/123」がマッチングしますが、「www.abc.com.cn」がマッチングしません。構成リストが127.0.0.1であると仮定すると、127.0.0.1/123もマッチングします。
> - 防犯リンクはワイルドカードマッチングをサポートします。即ち、リストが「*.qq.com」であると仮定すると、「www.qq.com」、「a.qq.com」もマッチングできます。

### refererホワイトリスト
1. ** 防犯リンク**をクリックしてオンにし、デフォルトでは【referer ホワイトリスト】が選択されています。referer ホワイトリストの構成を行うことができます。
   ユーザーがドメイン名「www.test.com」にrefererホワイトリストを構成していると仮定すると、ホワイトリストの内容が「www.abc.com」で、かつ「空のrefererを含む」が**未チェック**である場合、ユーザーはreferer値が「www.abc.com」であるリクエストアクセスのみを許し、他のリクエストがすべて403を返すことを示します。
   ![img](https://main.qcloudimg.com/raw/6f3a737f65e449f523e1675eaedaf0cc.png)
>?
>−リクエストされたrefererフィールドがホワイトリストに構成されている内容にマッチングしている場合、CDNノードはリクエスト情報を正常に返します。
>−リクエストされたrefererフィールドがホワイトリストに構成されている内容にマッチングしていない場合、CDNノードはこのリクエスト情報を返すことを拒否し、直接にステータスコード403を返します。　
>-ホワイトリストを構成する場合、CDNノードはこのホワイトリストの文字列の内容に合致しているリクエストのみを返すことができます。
>-「空のrefererを含む」オプションを**チェックした**場合、refererフィールドが空であるか、またはrefererフィールドがないと（たとえば、ブラウザリクエスト）、CDNはリクエスト情報を正常に返します。
2.構成が完了した後、スイッチがオン状態になり、下部に有効になっているrefererホワイトリストの構成情報が表示されます。【編集】をクリックして構成情報を変更することができます。
![img](https://main.qcloudimg.com/raw/dff4308fc9d07f231263eafe7c7aafc9.png)
3. **防犯リンク**スイッチをオフにすると、下部にある構成情報が無効になります。つまり、防犯リンクは無効になっています。再び手動でオンにすることができます。
![img](https://main.qcloudimg.com/raw/192b17814016f3148fc83f17e3bfae05.png)

### referer ブラックリスト
1. クリックして**防犯リンク**をオンにし、【refererブラックリスト】を選択してrefererブラックリストを構成することができます。
   ユーザーがドメイン名「www.abc.com」にrefererブラックリストを構成していると仮定すると、ブラックリストの内容が「www.test.com」で、かつ「空のrefererを含む」が**未チェック**である場合、referer値が「www.test.com」であるリクエストアクセスはすべて403を返し、他のリクエストは正常の内容を返します。
![img](https://main.qcloudimg.com/raw/9f524d173fe917c7523a59fbef8f4b51.png)
>?
>−リクエストされたrefererフィールドがブラックリストに構成されている内容にマッチングしている場合、CDNノードはこのリクエスト情報を返すことを拒否し、直接にステータスコード403を返します。　
>−リクエストされたrefererフィールドがブラックリストに構成されている内容にマッチングしていない場合、CDNノードはリクエスト情報を正常に返します。
>-「空のrefererを含む」オプションを**チェックした**場合、リクエストrefererフィールドが空であるか、またはrefererフィールド（たとえば、ブラウザリクエスト）がないと、CDNノードはこのリクエスト情報を返すことを拒否し、状態コード403を返します。
2.構成が完了した後、スイッチがオン状態になり、下部に有効になっているrefererブラックリストの構成情報が表示されます。【編集】をクリックして構成情報を変更することができます。
![img](https://main.qcloudimg.com/raw/4c7f6a01c0d2f2984bcd3c5a9c0c2f0d.png)
3. **防犯リンク**スイッチをオフにすると、下部にある構成情報が無効になります。つまり、防犯リンクは無効になっています。再び手動でオンにすることができます。
![img](https://main.qcloudimg.com/raw/2796c0a0b56f69e6b56a0ae73db54956.png)

##構成ケース
ドメイン名refererのコンフィグレーションは以下の通りである場合、
![img](https://main.qcloudimg.com/raw/4252af2551ec2d32db072d00011bba41.png)
-ユーザーはURLが「http://www.test.com/1.jpg?version=1.1」であるリソースをリクエストします。ブラウザを通じてアクセスし、refererが空であるとリクエストすると、正常にコンテンツを返します。
-ユーザーはURLが「http://www.test.com/1.jpg?version=1.1」であるリソースをリクエストします。refererが 「www.abcd.com」であるとリクエストすると、ホワイトリストにないので、直接に403を返します。
