
## 개념
사용자 상태 유형은 다음 세 가지가 있습니다.
- 포그라운드 실행 상태(Online)
- 백그라운드 실행 상태(PushOnline)
- 오프라인 상태(Offline)

>!백그라운드 실행(PushOnline) 상태는 모바일 클라이언트(Android, iOS, iPad)에만 존재하며, PC, Mac, Linux, 미니프로그램 또는 Web 클라이언트에는 존재하지 않습니다.

### 포그라운드 실행 상태(Online)
포그라운드 동작 상태(Online)는 클라이언트가 IM 서버와 원활한 TCP 네트워크 연결을 유지하고 있음을 의미하며, 클라이언트는 IM 서버로 메시지를 보내거나 IM 서버에서 푸시한 메시지를 수신할 수 있습니다.

**사용자가 App을 실행하면 포그라운드 실행 상태(Online)가 됩니다. **

App 활성화 후, 클라이언트와 IM 서버 사이에 TCP 지속 연결이 구축되고, IM 서버는 클라이언트의 온라인 정보(예: 클라이언트단 네트워크 링크 정보, 클라이언트단 플랫폼 버전 등)를 저장합니다. App이 실행 중일 때 IM SDK는 주기적으로 하트비트를 보내 사용자의 온라인 상태를 확인합니다.

>? 하트비트: IM SDK는 2분마다 서버에 하트비트 패킷을 전송하여 사용자의 온라인 상태를 확인합니다.

### 백그라운드 실행 상태(PushOnline)
백그라운드 실행 상태(PushOnline)는 클라이언트와 IM 서버 간의 TCP 지속 연결이 끊어진 상태를 나타내며, 메시지의 오프라인 푸시를 받을 수 있습니다.
다음 시나리오에서 사용자의 상태는 백그라운드 실행 상태(PushOnline)입니다.

- 사용자가 App 사용을 마치고 App이 백그라운드로 전환된 후 모바일 운영체제에 의해 App 프로세스가 kill 되거나 사용자가 직접 App 프로세스를 종료한 경우.
 App이 휴대폰 운영 체제의 연결 유지 허용 목록(화이트리스트)에 있는 상태에서 사용자가 App을 백그라운드로 전환하면 휴대폰 운영 체제에 의해 프로세스가 종료되지 않습니다. 이러한 경우에는 여전히 포그라운드(Online) 상태입니다. 포그라운드 실행 상태(Online)와 백그라운드 실행 상태(PushOnline)를 판단하는 기준 중 하나는 App 프로세스가 kill되었는지, 즉 클라이언트와 IM 서버 간의 TCP 지속 연결이 끊어졌는지 여부입니다.
- 사용자가 클라이언트 네트워크를 직접 비활성화(예: 휴대폰의 비행 모드 활성화) 하거나, 클라이언트 네트워크가 완전히 사용 불가 상태인 경우(예: 네트워크 신호가 전혀 없는 터널에 진입).
 이런 특별한 상황에서 클라이언트는 TCP FIN이나 RST 패킷을 보낼 수도 없습니다. IM 서버는 400초를 대기한 후, 하트비트 패킷이 타임아웃된 것을 발견하면 백그라운드 실행 상태(PushOnline)로 전환됩니다.

>!백그라운드 실행(PushOnline) 상태는 모바일 클라이언트(Android, iOS, iPad)에만 존재하며, PC, Mac, Linux, 미니프로그램 또는 Web 클라이언트에는 존재하지 않습니다.

### 오프라인 상태(Offline)
오프라인 상태(Offline)는 사용자가 계정과 비밀번호를 입력하지 않은 로그인 이전의 상태를 말하며, 이때 사용자는 메시지의 온/오프라인 푸시를 수신할 수 없습니다.
다음 시나리오에서 사용자의 상태는 오프라인 상태입니다(Offline).

- 사용자가 직접 로그아웃하거나 App 다운로드 후 로그인하지 않은 경우.
- 사용자 상태가 백그라운드 실행 상태(PushOnline)로 변경된 후, 7일 이내에 다시 로그인하지 않아 다시 오프라인 상태(Offline)로 전환된 경우.

## 사용자 온라인 상태 쿼리
App 백엔드는 [REST API: 사용자 온라인 상태 쿼리](https://intl.cloud.tencent.com/document/product/1047/35477)를 통해 여러 사용자의 온라인 상태를 일괄 쿼리할 수 있습니다.
IM SDK는 현재 사용자의 온라인 상태를 가져오기 할 수 없습니다.

## 사용자 온라인 상태 변경 알림
IM은 App 백엔드에게 사용자 온/오프라인 이벤트를 알림할 수 있습니다. [상태 변경 콜백](https://intl.cloud.tencent.com/document/product/1047/34357) 문서를 참고하십시오.

## 실시간 상태 변경 감지
### Android/iOS/iPad/PC/Mac/Linux
대부분의 경우 사용자 상태 변화를 실시간으로 감지할 수 있으며, 그 예시는 다음과 같습니다.
- 사용자가 직접 로그인하여 포그라운드 실행 상태(Online)로 전환된 경우.
- 사용자가 직접 로그아웃하여 오프라인 상태(Offline)로 전환된 경우.
- 사용자가 직접 클라이언트 프로세스를 kill하거나, 사용자가 백그라운드로 전환한 후 운영 체제에 의해 클라이언트 프로세스가 kill되어 백그라운드 실행 상태(PushOnline)로 전환된 경우.

다음과 같은 특별 상황에서 IM CVM은 400초의 하트비트 타임아웃 시간을 대기한 후 상태 변화를 감지합니다.
네트워크를 완전히 사용할 수 없고 클라이언트가 TCP FIN 또는 RST 패킷 조차 보낼 수 없는 경우, IM CVM은 400초의 하트비트 타임아웃 시간을 대기한 후 상태를 감지하여 백그라운드 실행 상태(PushOnline)로 전환합니다. 일반적인 시나리오는 사용자가 클라이언트단 네트워크를 직접 비활성화(예: 휴대폰의 비행 모드 활성화) 하거나, 클라이언트단 네트워크가 완전히 사용 불가 상태인 경우(예: 네트워크 신호가 전혀 없는 터널에 진입)입니다.

### Web
사용자가 Web에 로그인하면 IM CVM은 실시간으로 상태를 감지하여 포그라운드 실행 상태(Online)로 전환합니다.

다양한 시나리오에서의 종료/연결 중단의 상태 변경 실시간성은 다음과 같습니다.
- 페이지를 닫은 경우, 실시간 상태 감지 및 오프라인 상태(Offline) 전환.
- 페이지를 닫지 않은 상황에서 네트워크 연결이 중단된 경우, 60초 경과 후 상태 감지 및 오프라인 상태(Offline) 전환.
- 직접 destroy 인터페이스를 호출한 경우, 실시간 상태 감지 및 오프라인 상태(Offline) 전환.

### 미니프로그램
사용자가 미니프로그램단에 직접 로그인하면 IM CVM은 실시간으로 상태를 감지하여 포그라운드 실행 상태(Online)로 전환합니다.

다양한 시나리오에서의 종료/연결 중단의 상태 변경 실시간성은 다음과 같습니다.
- 우측 상단을 클릭하여 종료하면 5초 이내에 상태 감지 및 오프라인 상태(Offline)로 전환.
- 네트워크 연결이 끊긴 경우(예: 휴대폰 비행 모드 활성화) 60초 후 상태 감지 및 오프라인 상태(Offline) 전환.
- WeChat은 백그라운드 전환 약 30초 경과 후 오프라인 상태(Offline)로 전환.
- WeChat 프로세스를 종료한 경우, 실시간 감지 및 오프라인 상태(Offline) 전환.
- 직접 destroy 인터페이스를 호출한 경우, 실시간 감지 및 오프라인 상태(Offline) 전환.

## 멀티 디바이스 로그인
### 강제 오프라인
기본적으로 IM SDK는 동시에 여러 디바이스에서 동시 로그인(예: PC와 Android 동시 로그인)할 경우, 먼저 로그인한 디바이스를 강제 오프라인 상태로 전환하고, 마지막으로 로그인한 장치만 온라인 상태로 남겨둡니다. 자세한 강제 오프라인 로직은 다음 문서를 참고하십시오.

- [초기화(Android)](https://intl.cloud.tencent.com/document/product/1047/36255)
- [초기화(iOS)](https://intl.cloud.tencent.com/document/product/1047/39159)


### 동시 접속
IM은 [콘솔](https://console.cloud.tencent.com/im)에서의 동시 온라인 정책 수정을 지원합니다. 현재 지원되는 멀티 플랫폼 동시 접속 정책은 다음과 같습니다.
- 단일 플랫폼 로그인: Android, iPhone, iPad, Windows, Mac, Web 중 1개 플랫폼 로그인.
- 듀얼 플랫폼 로그인: Android, iPhone, iPad, Windows, Mac 중 1개 플랫폼 및 Web 동시 로그인.
- 트리플 플랫폼 로그인: Android, iPhone, iPad 중 1개 플랫폼, Windows, Mac 중 1개 플랫폼 및 Web 동시 로그인.
- 멀티 플랫폼 로그인: Android, iPhone, iPad, Windows, Mac, Web 전체 플랫폼 동시 로그인.

기본적으로 각 플랫폼당 1개의 디바이스 로그인만 지원됩니다(예: 두 Android 기기에서 동시 로그인 시, 하나는 강제 로그아웃됨). 울티메이트 버전 사용자는 Android, iPhone, iPad, Windows, Mac 중 동종 플랫폼에 로그인할 수 있는 최대 인스턴스 수를 구성할 수 있습니다. 또한 모든 사용자는 Web 플랫폼에 로그인할 수 있는 최대 인스턴스 수를 구성할 수 있습니다.
