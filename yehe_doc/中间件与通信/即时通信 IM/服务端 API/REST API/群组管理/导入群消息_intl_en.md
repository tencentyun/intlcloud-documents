## Overview
- This API is used to import group messages without triggering callbacks or sending notifications.
- When you are migrating your app from another instant messaging system to Tencent Cloud IM, you can use this API to import group message data.

## API Calling Description
### Applicable group types

| Group Type ID | Support for This RESTful API |
|-----------|------------|
| Private | Yes. Same as work groups (Work) in the new version. |
| Public | Yes |
| ChatRoom | Yes. Same as meeting groups (Meeting) in the new version. |
| AVChatRoom | No |
| Community | Yes |

Above are the built-in group types of IM. For more information, see [Group System](https://intl.cloud.tencent.com/document/product/1047/33529).

>?Audio-video groups (AVChatRoom) do not support importing group messages. If you attempt to import group messages for an audio-video group, error 10007 will be returned. Therefore, members of an audio-video group cannot view the messages sent before they join the group.


### Sample request URL
```
https://xxxxxx/v4/group_open_http_svc/import_group_msg?sdkappid=88888888&identifier=admin&usersig=xxx&random=99999999&contenttype=json
```
### Request parameters
The following table describes only the modified parameters when this API is called. For other parameters, see [RESTful API Overview](https://intl.cloud.tencent.com/document/product/1047/34620).

| Parameter | Description |
| ------------------ | ------------------------------------ |
| https | The request protocol is HTTPS, and the request method is POST. |
| xxxxxx | Domain name corresponding to the country/region where your SDKAppID is located.<li>Chinese mainland: `console.tim.qq.com`<li>Singapore: `adminapisgp.im.qcloud.com`<li>Seoul: `adminapikr.im.qcloud.com`<li>Frankfurt: `adminapiger.im.qcloud.com`<li>India: `adminapiind.im.qcloud.com`<li>Silicon Valley: `adminapiusa.im.qcloud.com` |
| v4/group_open_http_svc/import_group_msg | Request API |
| sdkappid | SDKAppID assigned by the IM console when an app is created |
| identifier | App admin account. For more information, see the **App Admin** section in [Login Authentication](https://intl.cloud.tencent.com/document/product/1047/33517). |
| usersig | Signature generated by the app admin account. For operation details, see [Generating UserSig](https://intl.cloud.tencent.com/document/product/1047/34385). |
| random | A random 32-bit unsigned integer ranging from 0 to 4,294,967,295 |
| contenttype   |Request format, which should always be `json`.|

### Maximum call frequency

200 calls per second

### Sample request

A single request can import up to seven group messages.
After messages are imported through this API, the unread message count for all members will become `0`. To retain the unread message count, you need to import group members or set the unread message count for members after importing all messages.
The messages must be imported in ascending order by timestamp, and the timestamps of imported messages must be earlier than the current time, and later than the group creation time and the creation time of the latest message in the group. Otherwise, the import will fail.

```
{
    "GroupId": "@TGS#2C5SZEAEF",
    "RecentContactFlag":1,// Means to trigger conversation update (This field is not supported by AVChatRoom groups.)
    "MsgList": [
        {
            "From_Account": "leckie", // Message sender
            "SendTime":1620808101,
            "Random": 8912345, // Random number of the message (optional)
            "MsgBody": [ // Message body, which consists of an element array. For details, see the `TIMMessage` message object.
                {
                    "MsgType": "TIMTextElem", // Text
                    "MsgContent":{
                        "Text": "red packet"
                    }
                },
                {
                    "MsgType": "TIMFaceElem", // Emoji
                    "MsgContent":{
                        "Index": 6,
                        "Data": "abc\u0000\u0001"
                    }
                }
            ]
        },
        {
            "From_Account": "peter", // Message sender
            "SendTime":1620892821,
            "MsgBody": [ // Message body, which consists of an element array. For details, see the `TIMMessage` message object.
                {
                    "MsgType": "TIMTextElem", // Text
                    "MsgContent":{
                        "Text": "red packet"
                    }
                }
            ]
        }

    ]
}
```

### Request fields

| Field | Type | Required | Description |
|---------|---------|---------|---------|
| GroupId | String | Yes | ID of the group for which to import messages |
|RecentContactFlag|Integer| No | Whether to trigger conversation update. The value `1` means to trigger conversation update. Conversation update is not triggered by default. (This field is not supported by AVChatRoom groups.) |
| MsgList | Object | Yes | List of the messages to be imported  |
| From_Account | String | Yes | Message sender |
| SendTime | Integer | Yes | Message sending time |
| Random | Integer | No | A 32-bit unsigned integer. If the random numbers of two messages within five minutes are the same, the later message will be discarded as a repeated message. |
| MsgBody | Array | Yes | TIM message. For more information, see the definition of `TIMMsgElement` in [Message Formats](https://intl.cloud.tencent.com/document/product/1047/33527). |
| MsgType | String | Yes | TIM message object type. Valid values: `TIMTextElem` (text message), `TIMFaceElem` (emoji message), `TIMLocationElem` (location message), `TIMCustomElem` (custom message) |
| MsgContent | Object | Yes | TIM message object. For more information, see the definition of `TIMMsgElement` in [Message Formats](https://intl.cloud.tencent.com/document/product/1047/33527). |
| TopicId | String | No | The ID of the topic. This option is only avaiable for the community that supports the topic feature.|

### Sample response

```
{
    "ActionStatus": "OK",
    "ErrorInfo": "",
    "ErrorCode": 0,
    "ImportMsgResult": [
        {
            "MsgSeq": 1,
            "MsgTime": 1620808101,
            "Result": 0
        },
        {
            "MsgSeq": 2,
            "MsgTime": 1620892821,
            "Result": 0
        },
    ]
}
```

### Response fields

| Field | Type | Description |
|---------|---------|---------|
| ActionStatus | String | Request result. `OK`: Successful; `FAIL`: Failed |
| ErrorInfo | String | Error information |
| ErrorCode | Integer | Error code. `0`: Successful; other values: Failed |
| ImportMsgResult | Array | Message import result |
| Result | Integer | Result of each message <ul><li>`0`: The message was imported successfully. </li><li>`10004`: The sending time of the message is invalid. </li><li>`80002`: The message content exceeds the limit of 8,000 bytes. Please adjust the message size. |
| MsgTime | Integer | Message timestamp   |
| MsgSeq | Integer | Message sequence number, the unique identifier of a message |

## Error Codes

The returned HTTP status code for this API is always 200 unless a network error (such as error 502) occurs. The specific error code and details can be found in the response fields `ErrorCode` and `ErrorInfo` respectively.
For public error codes (60000 to 79999), see [Error Codes](https://intl.cloud.tencent.com/document/product/1047/34348).
The following table describes the error codes specific to this API:

| Error Code | Description |
|---------|---------|
| 10004 | Invalid parameter. Check the error description and troubleshoot the issue. |
| 10007 | No operation permissions. This error occurs when, for example, a member in a public group tries to remove other users from the group (only the app admin can perform this operation). |
| 10010 | The group does not exist or has been disbanded. |
| 10015 | The group ID is invalid. Use the correct group ID. |
| 10020 | The message is too large. Currently, the maximum message size supported is 8,000 bytes. Adjust the message size. |


## API Debugging Tool

Use the [online debugging tool for RESTful APIs](https://29294-22989-29805-29810.cdn-go.cn/api-test.html#v4/group_open_http_svc/import_group_msg) to debug this API.

## References
Setting the Unread Message Count of a Member ([v4/group_open_http_svc/set_unread_msg_num](https://intl.cloud.tencent.com/document/product/1047/34909))
