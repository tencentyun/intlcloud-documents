## 同期遅延の影響
MySQLのデフォルトのスレーブデータベース、ディザスタリカバリインスタンス、読み取り専用インスタンスはいずれもMySQLのネイティブbinlogレプリケーションテクノロジーを使用しており、データのレプリケーション方式が非同期または準同期レプリケーションの時、いずれも遅延が発生する恐れがあります。

- [スレーブデータベース](https://cloud.tencent.com/document/product/236/17136#.E9.AB.98.E5.8F.AF.E7.94.A8.E7.89.88)に遅延が存在する場合、マスター/スレーブインスタンスが短時間内で切り替えを完了できなくなることにより、ビジネスに影響し短時間内に正常に回復できなくなります。

- 読み取りサービスがデータの整合性に対して高い要求がある場合、[読み取り専用グループ](https://intl.cloud.tencent.com/document/product/236/11361#.E9.85.8D.E7.BD.AE.E5.8F.AA.E8.AF.BB.E5.AE.9E.E4.BE.8B-ro-.E7.BB.84)が遅延削除ポリシーを設定することができます。読み取り専用インスタンスとマスターインスタンスの遅延時間がしきい値を超えた時、対応する読み取り専用インスタンスは自動的に削除され、それにより読み取りサービスは読み取り専用インスタンスに正常にアクセスすることができなくなります。

### 同期遅延ソリューション
[監視機能](https://cloud.tencent.com/document/product/236/8455#.E7.9B.91.E6.8E.A7.E5.88.86.E7.B1.BB)により、【マスター/スレーブの遅延時間】を確認することができ、マスター/スレーブの遅延時間が0より大きい場合、そのインスタンスにデータ遅延が存在することを表します。一般的な原因は以下のとおりです。

### 非プライマリキーまたはセカンダリインデックス
**原因**
binlogがrow形式でかつテーブルが非プライマリキーまたはセカンダリインデックスの場合、ビッグテーブルに対してDML操作（例：delete、update、insert）を行い、スレーブデータベースでbinlogアプリケーションを行う時、プライマリキーまたはセカンダリインデックスに基づき変更する必要のある行を検索します。対応するテーブルがプライマリキーまたはセカンダリインデックスを作成していない場合、大量の全テーブルスキャンが発生することによりログ応用の速度が低下し、その結果、データ遅延が発生します。

**ソリューション**
- すべてのテーブルにプライマリキーを作成します。テーブルにプライマリキーを作成できない場合、基数が高い列を選択してセカンダリインデックスを作成することをお勧めします。
- truncateコマンドを使用してテーブルのすべての記録を削除することをお勧めします。

### 大規模トランザクション
**原因**
マスターインスタンスが大量のデータを含むDML操作を実行し、大量のbinlogがスレーブデータベースに送信される時、スレーブデータベースはマスターインスタンスと同じ時間を費やして対応するトランザクションを完了する必要があり、それによりスレーブデータベースにデータ遅延が発生します。

**ソリューション**
大規模トランザクションを小規模トランザクションに分割し、where条件により毎回処理するデータ量を制限することをお勧めします。これにより、スレーブデータベースの迅速なトランザクション実行完了に役立ち、スレーブデータベースの遅延発生が避けられます。

### DDL操作
**原因**
大規模トランザクションの原理と似ており、マスターインスタンスでのDDL操作の実行時間が長い場合、スレーブデータベースで同じかそれ以上の時間を費やしてこの操作を実行するため、DDL操作が妨害される可能性があります。

**ソリューション**
ビジネスのオフピーク期間にDDL操作を実行することをお勧めします。ディザスタリカバリインスタンス、読み取り専用インスタンスのクエリビジネスによりDDL操作がブロックされた場合、ブロックされたセッションを直接強制終了して、マスター/スレーブデータの同期をリカバーすることをお勧めします。

### インスタンスの規格が小さすぎる
**原因**
ディザスタリカバリインスタンス、読み取り専用インスタンスの規格がマスターインスタンスよりも小さく、かつ負荷が高いと、ディザスタリカバリインスタンス、読み取り専用インスタンスのデータ遅延が発生します。

**ソリューション**
ディザスタリカバリインスタンス、読み取り専用インスタンスの規格をマスターインスタンス以上にすることをお勧めします。ディザスタリカバリインスタンス、読み取り専用インスタンスが大量の分析類ビジネスをホストすることによりインスタンスの負荷が過剰に高くなった場合、そのインスタンスの規格を適切な構成にアップグレードするか、低パフォーマンスのSQLステートメントを最適化する必要があります。
