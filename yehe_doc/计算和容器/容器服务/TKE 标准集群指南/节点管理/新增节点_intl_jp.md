## 操作ケース

次の方法を使用して、クラスターにノードを追加できます。
- [ノードの新規作成](#createNode)
- [既存ノードの追加](#addExistingNode)

## 前提条件

[Tencent Kubernetes Engineコンソール](https://console.cloud.tencent.com/tke2)にログインされています。

## 操作手順

[](id:createNode)
### ノードの新規作成

1. 左側ナビゲーションバーでは、【[クラスター](https://console.cloud.tencent.com/tke2/cluster)】をクリックして、「クラスター管理」ページへ進みます。
2. Cloud Virtual Machine（CVM）の作成を必要とするクラスターIDをクリックして、クラスターの詳細ページへ進みます。
3. ページ左側の【ノード管理】>【ノード】を選択して、ノードリストページへ進み、【ノードの新規作成】をクリックします。
4. 「ノードの新規作成」ページでは、実際のニーズに応じて、関連パラメータを構成します。下図の通りです：
![](https://main.qcloudimg.com/raw/952eb1e912940ebc080949f0a1dae13e.png)
主なパラメータの情報は以下の通りです：
  - **課金モード**：【従量課金制】と【年次および月次】の2つの課金モードを提供します。詳細については、[課金モード](https://intl.cloud.tencent.com/document/product/213/2180)をご参照ください。
  - **Availability Zone**：このパラメーターは、Availability Zoneで使用可能なサブネットのリストをフィルタリングするためにのみ使用されます。
  - **クラスターネットワーク**：この新しいノードにIPをアサインするサブネットを選択します。シングルノードの作成操作では、シングルサブネットのみがサポートされます。
  - **モデルの構成**：【モデルの選択】をクリックし、ポップアップ表示された「モデルの構成」のウィンドウでは、次の情報を参照して必要に応じて選択します：
    - **モデル**：CPUコアの数、メモリサイズ、インスタンスタイプによるフィルタリングをサポートします。詳細については、[インスタンス仕様](https://intl.cloud.tencent.com/document/product/213/11518)をご参照ください。
    - **システムディスク**：ストレージコントロール、CVMの実行をスケジューリングするシステムのコレクションです。選択したモデルの選択可能なシステムディスクタイプの表示をサポートします。[ Cloud Block Storageタイプ ](https://intl.cloud.tencent.com/document/product/362/31636)をご参照ください。実際のニーズに応じて選択します。
    - **データディスク**：すべてのユーザーデータを保存するために使用されます。
  - **インスタンス名称**：コンソールによって表示されているCVMインスタンス名称です。このプロパティは、ホスト名の命名モードによって制限されます。次の2つの命名方法を提供します。
        - **自動命名**：ホスト名は自動命名モードで、バッチ連続命名または指定パターン文字列命名をサポートします。最大60文字まで入力できます。インスタンス名は、デフォルトで`tke_cluster_id_worker`の形式で自動的に生成されます。
        - **手動命名**：ホスト名は手動命名モードで、インスタンス名はホスト名と同じで、再構成は必要ありません。
 - **ログイン方法**：以下の3つのログイン方法を提供します。実際の状況に応じて選択してください。
    -  **キーへのすぐアソシエイト**：キーペアは、アルゴリズムによって生成されたパラメータのペアで、通常のパスワードよりも安全にCVMにログインする方法です。詳細については、[SSHキー](https://intl.cloud.tencent.com/document/product/213/6092)をご参照ください。
      - **SSHキー**：この構成項目は、【キーへのすぐアソシエイト】のログイン方法が選択されている場合にのみ表示されます。ドロップダウン・リストで既存のキーを選択できます。新規作成を必要とする場合は、[SSHキーの新規作成](https://intl.cloud.tencent.com/document/product/213/16691)をご参照ください。
    - **パスワードの自動生成**：自動的に生成されたパスワードは[内部メッセージ](https://console.cloud.tencent.com/message)経由で送信されます。 
    - **パスワードの設定**：プロンプトに従って、対応するパスワードを設定してください。
 - **セキュリティグループ**：デフォルトでは、クラスターの作成時に設定されたセキュリティグループです。実際のニーズに応じて置き換えるか、または追加できます。
 - **数**：インスタンスの数を作成し、実際のニーズに応じて設定してください。
5. （オプション）「ノードの新規作成」ページで【他の設定】をクリックして、他の情報を確認するか、または構成します。下図の通りです：
![](https://main.qcloudimg.com/raw/54bbd92b00eea36efaf6de36c850b7eb.png)
  - **CAMロール**：このバッチで作成されたすべてのノードを同じCAMロールにバインディングし、ロールにバインディングされた許可ポリシーをノードに割り当てることができます。詳細については、[インスタンスロールの管理](https://intl.cloud.tencent.com/document/product/213/38290)をご参照ください。
  - **コンテナディレクトリ**：コンテナとイメージの保存ディレクトリを設定するにはチェックしてください。データディスクに保存することをお勧めします。例えば、`/var/lib/docker`。
  - **Security Reinforce**：デフォルトでは、DDoS保護、WAF、Host Securityホスト保護がフリークォータでアクティブになっています。詳細については、[ T-Secホストセキュリティ公式サイトホームページ](https://intl.cloud.tencent.com/product/cwp)をご参照ください。
  - **クラウド監視**：デフォルトでは、クラウド製品の監視、分析、およびアラームの実装がフリークォータでアクティブになっています。ホスト監視指標を取得するためのコンポーネントがインストールされています。詳細については、[クワウド監視CM公式サイトホームページ](https://intl.cloud.tencent.com/product/cm)をご参照ください。
  - **初期ノードのコルドン**：「コルドンをオンにする」をチェックすると、このノードへの新しいPodのスケジューリングが受け入れられなくなります。コルドンされたノードを手動で削除するか、カスタマイズされたデータで[コルドンコマンドの削除](https://intl.cloud.tencent.com/document/product/457/30654)を実行する必要があります。必要に応じて設定してください。
  - **Label**：【追加Label】をクリックして、Labelをカスタマイズ設定できます。後でLabelに基づいてノードをフィルタリングおよび管理するために使用できます。
  - **カスタマイズデータ**：カスタマイズデータを指定してノードを構成します。つまり、ノードの起動時に構成されたスクリプトを実行します。スクリプトの再入可能および再試行ロジックを確認します。スクリプトとその生成されたログファイルは、ノードの`/usr/local/qcloud/tke/userscript`パスで確認できます。

[](id:addExistingNode)
### 既存ノードの追加

>!
>- 現在、同じVPCでCVMを追加するのみがサポートされます。
>- パブリックゲートウェイCVMをクラスターに追加しないでください。このタイプのCVMを再インストールしてクラスターに添加すると、DNS異常が発生し、このノードが使用できなくなります。

1. 左側ナビゲーションバーでは、【[クラスター](https://console.cloud.tencent.com/tke2/cluster)】をクリックして、「クラスター管理」ページへ進みます。
2. 既存ノードの追加を必要とするクラスターIDをクリックして、クラスターの詳細ページへ進みます。
3. 【ノード管理】>【ノード】を選択して、【既存ノードの追加】をクリックします。下図の通りです：
![](https://main.qcloudimg.com/raw/7407fd0e78baa86ae7ea089f108c54c9.png)
4. 「ノードの選択」ページでは、追加を必要とするノードをチェックし、【次へ】をクリックします。
5. 「CVM構成」ページでは、クラスターへの追加を必要とするCVMを構成します。
主なパラメータの情報は以下の通りです：
 - データディスクのマウント：関連設定のフォーマットマウント：デバイス名、フォーマットシステム、マウントポイントを入力してください。
    - チェックを外した場合：データディスクマウントのオプションが設定されません。手動またはスクリプトを使用してマウントできます。
    - チェックを入れた場合：次のパラメータの入力が必須である：デバイス名、フォーマットシステム（フォーマットしないことを選択できる）、マウントポイント。
     デバイス/dev/vdbをext4としてフォーマットし、/var/lib/dockerディレクトリにマウントする場合は、次のように設定できます：
     デバイス名：/dev/vdb、フォーマットシステム：ext4、マウントポイント：/var/lib/docker
<dx-alert infotype="notice" title="">
- 重要なデータを事前にバックアップしてください。自分でディスクをフォーマットした場合は、マウントポイントに入力するだけで、フォーマットシステムを選択する必要はありません。
- 入力したフォーマットマウント設定は、このバッチで追加されたすべてのノードで有効になります。入力したデバイス名（例えば、/dev/vdb）が期待通りであることを確認してください（CBSにホットプラグなどを行う場合、デバイス名は変わる場合があります）。
- ディスクのパーティション/LVMを実行した場合は、デバイス名にパーティション名/LVM名を入力し、対応するフォーマットマウントパラメータを構成します。
- エラーのデバイス名を入力すると、システムはエラーを報告し、ノードの初期化プロセスを終了します。
- 入力したマウントポイントが存在しない場合、システムは対応するディレクトリを作成し、エラーは報告されません。
</dx-alert>
 - コンテナディレクトリ：コンテナとイメージの保存ディレクトリを設定します。データディスクに保存することをお勧めします。
 - OS：OSはクラスターレベルです。クラスターの詳細ページへ進んで変更できます。変更後、新規追加または再インストールされたノードは新しいOSを使用します。
 - ログイン方法：
     - パスワードの設定：プロンプトに従って、対応するパスワードを設定してください。
    - キーへのすぐアソシエイト：キーペアは、アルゴリズムによって生成されたパラメータのペアで、通常のパスワードよりも安全にCVMにログインする方法です。詳細については、[SSHキー](https://intl.cloud.tencent.com/document/product/213/6092)をご参照ください。
    - パスワードの自動生成：自動的に生成されたパスワードです。このパスワードは、内部メッセージ経由で送信されます。
 - セキュリティグループ：CVMのネットワークアクセスコントロールに使用されます。実際のニーズに応じて選択してください。【セキュリティグループの新規作成】をクリックして、他のポートをインターネットにオープンすることもできます。
6. 【完了】をクリックします。





