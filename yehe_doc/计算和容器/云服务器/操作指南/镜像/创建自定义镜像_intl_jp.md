## 操作シナリオ
Tencent Cloudが提供するパブリックイメージ、マーケットプレイスイメージに加えて、カスタムイメージを作成することもできます。カスタムイメージを作成した後、Tencent Cloudコンソールでこのカスタムイメージを使用して同じ構成のCVMインスタンスをすばやく作成できます。


<dx-alert infotype="explain" title="">
イメージ下位層がCloud Block Storageスナップショットサービスを使用しているため：
 - 国内リージョンでは50GBの無料利用枠が提供されます。詳細については[利用枠の贈呈](https://intl.cloud.tencent.com/document/product/362/32415)をご参照ください。
 - カスタムイメージを作成する場合、デフォルトでイメージに関連付けられたスナップショットが作成されます。カスタムイメージを保持すると一定のスナップショット料金が発生します。詳細については[スナップショットの料金概要]（](https://intl.cloud.tencent.com/document/product/362/32415)をご参照ください。
</dx-alert>




## 注意事項

- 各リージョンは、最大10個のカスタムイメージをサポートします。
- 以下のディレクトリ/ファイルがクリアされます：
 - `/var/log/`  
 - `/root/.bash_history、/home/ubuntu/.bash_history`（Ubuntu  システム）
- Linuxインスタンスを使用してカスタムイメージを作成する時、`/etc/fstab`にデータディスク構成が含まれていないことを確認してください。そうでなければ、このイメージで作成されたインスタンスを正常に起動できません。カスタムイメージを作成するLinuxインスタンスにデータディスクがマウントされている場合、`/etc/fstab` で関連するデータディスク構成をコメントアウトまたは削除する必要があります。
- 作成プロセスは10分以上かかりますが、具体的な時間はインスタンスのデータサイズによって異なります。業務への影響を避けるためには、事前に関連準備を行ってください。
- Cloud Physical Machine2.0は、現在、使用コンソールとAPIを利用したカスタムイメージの作成をサポートしていません。Cloud Virtual Machine（CVM）を使用して作成することができます。
- Windowsインスタンスがドメインにアクセスし、ドメインアカウントを使用する必要がある場合は、カスタムイメージを作成する前に、Sysprep操作を実行し、インスタンスがドメインにアクセスした後のSIDが一意になるようにしてください。詳細については[Sysprepを使用してCVMがドメインにアクセスした後のSIDの一意を実現する](https://intl.cloud.tencent.com/document/product/213/35876)をご参照ください。

## 操作手順
<dx-tabs>
::: コンソールを利用したインスタンスからの作成

#### インスタンスのシャットダウン（オプション）
1. [CVMコンソール](https://console.cloud.tencent.com/cvm)にログインし、対応するインスタンスのシャットダウンが必要かどうかを確認します。
<dx-alert infotype="notice" title="">
2018年7月以降にパブリックイメージを元に作成されたインスタンス（システムディスクはCBS）はオンラインイメージ制作（インスタンスをシャットダウンせずにイメージを制作すること）をサポートしています。これ以外でのインスタンスは、インスタンスをシャットダウンしてからイメージを制作し、イメージが現在のインスタンスデプロイ環境と完全に一致するようにしてください。
</dx-alert>
  - 必要である場合は、引き続き手順を実行します。
  - 必要でない場合は、 [カスタムイメージ制作](#createOS)手順を実行してください。
2. 下図に示すように、インスタンスの管理ページでインスタンスが配置されている行の右側の**さらに表示** > **インスタンス状態** > **シャットダウン**を選択します。
![シャットダウン](https://main.qcloudimg.com/raw/cc0bb1c82b96cca94cb7c1c011b664a7.png)


#### カスタムイメージの制作[](id:createOS)
1.下図に示すように、 このインスタンスが配置されている行で、**さらに表示** > **イメージ制作**を選択します。
![](https://main.qcloudimg.com/raw/8e3fc28e1a0b1e9e337ff72e34a9fd01.png)
2. ポップアップした「カスタムイメージ制作」ウィンドウで、次の情報を参考に設定します。
  - **イメージ名**と**イメージの説明**：名称と説明をカスタマイズします。
  - **システムディスクイメージのみを作成**：チェックを入れると、インスタンスシステムディスクイメージのみが作成されます。チェックを外すと、インスタンスがデータディスクを保有する場合は、データディスクスナップショットが同時に作成されます。
3. **イメージ制作**をクリックします。
左側ナビゲーションバーの **[イメージ](https://console.cloud.tencent.com/cvm/image)**をクリックすると、「イメージ」ページでイメージの作成状況を確認することができます。


#### カスタムイメージを利用したインスタンスの作成（オプション）
下図に示すように、イメージの作成が完了したら、イメージリストから作成したイメージを選択し、それが配置されている行の右側の**インスタンス作成**をクリックすると、以前と同じイメージのサーバーを購入できます。
![](https://main.qcloudimg.com/raw/2d64df77d16b3c26d275770e03a1caf1.png)

:::
::: \sAPI\sを利用した作成
CreateImageインターフェースを利用してカスタムイメージを作成することができます。具体的な内容については[イメージ作成API](https://intl.cloud.tencent.com/zh/document/product/213/33276)をご参照ください。
:::
</dx-tabs>

## ベストプラクティス

### データディスク上のデータ移行

新しいインスタンスを起動する同時に、元のインスタンスデータディスクのデータを保持する必要がある場合、最初にデータディスクの[スナップショット](https://intl.cloud.tencent.com/document/product/362/31638)を作成してください。 新しいインスタンスを起動する時に、このデータディスクのスナップショットを利用して新しいクラウドデータディスクを作成します。
詳細については、 [スナップショットを使用してクラウドディスクの作成](https://intl.cloud.tencent.com/document/product/362/5757)をご参照ください。
