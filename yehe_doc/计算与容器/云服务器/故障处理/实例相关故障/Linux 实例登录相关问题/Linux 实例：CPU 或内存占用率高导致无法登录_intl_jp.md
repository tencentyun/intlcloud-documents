## ユースケース

このドキュメントでは、CPUまたはメモリの使用率が高いためにLinux CVMにログインできないなどの問題の調査方法と解決策について説明します。

## 操作手順

### ログインしてシステム負荷を確認する

1. 実際のニーズに応じて、ログイン方法を選択して、CVMにログインします。
	- サードパーティソフトウェアを利用してLinux CVMにリモートログインします。
	>!  Linux CVMのCPU負荷が高い場合、ログインができなくなる可能性があります。
	>
	- **VNC 方式** でCVMにログインします。
	「[CVMコンソール](https://console.cloud.tencent.com/cvm)にログインし、インスタンスの右側操作列の【ログイン】をクリックして、VNC 方式を選択してCVMにログインします。
	>! Linux CVMのCPU負荷が高い場合、コンソールから正常にログインできます。
	>
2. 以下のコマンドを実行して、システム負荷を確認します。`%CPU` 列と `%MEM` 列を確認して、リソースの使用率が高いプロセスを特定します。
```
top
```

### プロセスを終了する

1. 異なるプロセスのリソースの利用状況を分析して、終了する必要があるプロセスのPIDを記録します。
2. ` k `を入力します。
3. 終了する必要があるプロセスのPIDを入力し、 **Enter** キーを押して、プロセスを終了します。下図に示すように：
ここはPIDが23のプロセスを終了する方法を例に説明します。
![](//mc.qcloudimg.com/static/img/61cd74354cf2b4d2a80a83528a500f5c/image.png)
>! **Enter** キーを押すと `kill PID 23 with signal [15]:`が表示されたら、 **Enter** キーを再度押して、デフォルト設定のままで実行します。
>
4. 操作が成功すると、インターフェースに確認メッセージ` Send pid 23 signal [15/sigterm] ` が表示されます。 **Enter**キーを押して終了します。

### CPU使用率が低いが、負荷が高い場合の対応

#### 問題の説明

load average はCPU負荷の指標です。load averageの値が高ければ高いほど、タスクキューが長くなり、処理待ちのタスクが多くなります。
topを実行すると、下図に示すように、CPU使用率が非常に低いが、load averageが非常に高いです。
![](//mc.qcloudimg.com/static/img/4ddf663a68ee602d8cf8075d88edccf6/image.png)
 
#### ソリューション 
 
以下のコマンドを実行して、プロセスの状態を表示し、D状態のプロセスが存在するかを確認します。下図に示すように：
```
ps -axjf
```
![](//mc.qcloudimg.com/static/img/32420d3fe022b57d85120c941705dbf6/image.png)
 >? D状態は中断不可のスリープ状態です。D 状態のプロセスを削除することができなく、自ら終了することもできません。 D 状態のプロセスが多数ある場合は、プロセスが依存するリソースを復元するか、システムを再起動することで問題を解決できます。
 >


### kswapd0プロセスのCPU使用率が高い場合の対応

#### 問題の説明

Linux OSはページングメカニズムを利用してメモリを管理し、ディスクの一部を仮想メモリとして割り当てます。kswapd0はLinux OSの仮想メモリ管理におけるページ置換を担当するプロセスです。システムメモリが不足している場合、kswapd0は頻繁にページ置換を実行します。ページ置換が非常にCPUリソースを消費するため、当該プロセスは継続的に大量のCPUリソースを使用します。
 
#### ソリューション 

1. 以下のコマンドを実行して、kswapd0 プロセスを特定します。
```
top
```
2. kswapd0プロセスの状態を監視します。
プロセスがスリープ状態ではなく、長時間実行されて、継続的に大量のCPUリソースを使用している場合は、[ステップ3](#kswapd0_step3)を実行してメモリの使用状況を確認してください。
3. <span id="kswapd0_step3"> `free`、`ps` 等のコマンドを実行して、システムプロセスのメモリ使用状況を確認します。</span>
メモリの使用状況に応じて、システムを再起動するか不必要かつ安全なプロセスを終了します。

kswapd0プロセスの問題がまだ存在する場合、[CPU 使用率が高すぎる（Linux システム）](https://intl.cloud.tencent.com/document/product/213/14634) を参考してください。
