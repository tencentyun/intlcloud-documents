## 操作シナリオ
[セキュリティグループ](https://intl.cloud.tencent.com/doc/product/213/12452)は、フィルタリング機能を備えたステートフル仮想ファイアウォールであり、単一または複数のクラウドデータベースのネットワークアクセス制御を設定するために使用されます。また、Tencent Cloudが提供する重要なNetwork Security隔離手段でもあります。セキュリティグループは論理的にグループ化したもので、同じリージョン内で同じネットワークセキュリティ隔離要件を持つクラウドデータベースインスタンスを、同じセキュリティグループ内に追加できます。クラウドデータベースはCVMなどとセキュリティグループリストを共有し、セキュリティグループ内でルールに基づいてマッチングされます。ルールと制限の詳細については、[セキュリティグループ詳細説明](https://intl.cloud.tencent.com/document/product/215/38750)をご参照ください。

>?
>- TencentDB for MySQLのセキュリティグループは現在、Virtual Private Cloud（VPC）プライベートネットワークアクセスとパブリックネットワークアクセスによるネットワーク制御のみサポートしており、基本ネットワークのネットワーク制御はサポートしていません。
>- フランクフルト、シリコンバレー、シンガポールの各リージョンのインスタンスは現在、データベースパブリックネットワークアクセスのセキュリティグループ機能をサポートしていません。
>- クラウドデータベースは自発的にトラフィックをアウトバウンドしていないことから、アウトバウンドルールはクラウドデータベースに対して有効になりません。
>- TencentDB for MySQLのセキュリティグループはマスターインスタンス、読み取り専用インスタンス、ディザスタリカバリインスタンスをサポートしています。
>- TencentDB for MySQL単一ノード - 基礎バージョンはセキュリティグループに対応していません。


## クラウドデータベースのためにセキュリティグループを設定
### 手順1：セキュリティグループの作成
1. [CVMコンソール](https://console.cloud.tencent.com/cvm/securitygroup)にログインします。
2. 左側のナビゲーションで【セキュリティグループ】ページを選び、リージョンを選択して【新規作成】をクリックします。
3. ポップアップで表示されたダイアログボックスで、次の設定を完了し、確認後に【OK】をクリックします。
 - テンプレート：セキュリティグループ内のデータベースインスタンスがデプロイする必要のあるサービスを基に、適切なテンプレートを選択し、セキュリティグループルールの構成を簡素化します。次の表で示します。
<table>
	<tr><th>テンプレート</th><th>説明</th><th>説明</th></tr>
	<tr><td>全ポートの開放</td><td>デフォルトでは、全ポートをパブリックネットワークとプライベートネットワークに開放するので、一定のセキュリティリスクがあります。</td><td>-</td></tr>
	<tr><td>22、80、443、3389ポートとICMPプロトコルを開放</td><td>デフォルトでは、22、80、443、3389ポートとICMPプロトコルを開放します。プライベートネットワークではすべて開放します。</td><td>このテンプレートはクラウドデータベースに対して無効です。</td></tr>
	<tr><td>カスタマイズ</td><td>セキュリティグループの作成が成功した後、必要に応じて自らセキュリティグループのルールを追加します。操作の詳細は次の「セキュリティグループのルールの追加」</a>をご参照ください。</td><td>-</rd></tr>
</table>
 - 名称：セキュリティグループ名をカスタマイズ設定。
 - 所属プロジェクト：デフォルトでは「デフォルト項目」を選択します。その他のプロジェクトに指定して、その後の管理を行いやすくできます。
 - 備考：セキュリティグループのカスタマイズされた簡潔な説明により、その後の管理を行いやすくできます。


### 手順2：セキュリティグループのルールの追加
1. [セキュリティグループのページ](https://console.cloud.tencent.com/cvm/securitygroup)で、ルールを設定するセキュリティグループの行で、「操作」の列の【ルールの修正】をクリックします。
2. セキュリティグループのルールページで、【インバウンドルール】>【ルール追加】を選択します。
3. ポップアップで表示されたダイアログボックスで、ルールを設定します。
 - タイプ：デフォルトで「カスタマイズ」を選択します。その他のシステムルールテンプレートを選択することもできます。MySQL(3306) テンプレートを選択することをお勧めします。
 - ソース：トラフィックの送信元（インバウンドルール） または宛先（アウトバウンドルール）。次のオプションから1つを指定してください。
<table>
	<tr><th>指定のソース/ターゲット</th><th>説明</th></tr>
	<tr><td>単一のIPv4アドレスまたはIPv4アドレス範囲</td><td>CIDR表記法を使用します（例：<code>203.0.113.0</code>、<code>203.0.113.0/24</code>または<code>0.0.0.0/0</code>。そのうち、<code>0.0.0.0/0</code>はすべてのIPv4アドレスにマッチングしていることを表します）。</td></tr>
	<tr><td>単一のIPv6アドレスまたはIPv6アドレス範囲</td><td>CIDRで表記（例えば、<code>FF05::B5</code>、<code>FF05:B5::/60</code>、<code>::/0</code>または<code>0::0/0</code>。この内、<code>::/0</code>または<code>0::0/0</code>はすべてのIPv6アドレスに一致することを示しています）。</td></tr>
	<tr><td>セキュリティグループIDの参照。次のセキュリティグループのIDを参照できます：<ul  style="margin: 0;"><li>セキュリティグループ ID</li><li>その他のセキュリティグループ</li></ul>
</td><td><ul  style="margin: 0;"><li>現在のセキュリティグループは、セキュリティグループと関連するCVMを示します。</li><li>その他のセキュリティグループは、同一リージョンの同一プロジェクト内のもう1つのセキュリティグループIDであることを示します。</li></ul>
</td></tr>
	<tr><td><a href="https://intl.cloud.tencent.com/document/product/215/31867">パラメーターテンプレート</a>内のIPアドレスオブジェクトまたはIPアドレスグループオブジェクトを引用します</td><td>-</td></tr>
</table>
 - プロトコルポート：プロトコルタイプとポート範囲を入力します。 [パラメータテンプレート](https://intl.cloud.tencent.com/document/product/215/31867) のプロトコルポートまたはプロトコルポートグループの参照もできます。
>!TencentDB for MySQLに接続するには、MySQLインスタンスポートが許可されている必要があります。[MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスIDをクリックすると、詳細ページに移動してポートを確認できます。
>![](https://main.qcloudimg.com/raw/9f471c644eb9a5aa86bd092fdebd0255.png)
>
>- MySQLプライベートネットワークのデフォルトのポートは3306となりますが、同時にポートのカスタマイズもサポートしています。デフォルトのポート番号を変更している場合は、セキュリティグループの中でMySQLの新規ポート情報を開放する必要があります。
>- MySQLパブリックネットワークのデフォルトポートは60719です。パブリックネットワークが有効になると、セキュリティグループネットワークアクセスポリシーによって制御されます。セキュリティポリシーを設定する際は、ポート60719と3306を同時に開放する必要があります。
>- MySQLコンソールのセキュリティグループページで設定されたセキュリティグループルールは、プライベートネットワークアドレスとパブリックネットワークアドレス（有効な場合）の両方に対して一律に有効になります。
>
 - ポリシー：デフォルトでは「許可」が選択されています。
    - 許可：そのポートに対応するアクセスリクエストを承諾します。
    - 拒否：データパケットを直接破棄し、レスポンス情報は返しません。
 - 備考：カスタマイズされたルールの簡潔な説明により、後の管理を行いやすくします。
4. 【完了】をクリックして、セキュリティグループのインバウンドルール追加を完了します。

#### 事例
**シナリオ：**1つのTencentDB for MySQLを作成して、Cloud Virtual Machine（CVM）によるTencentDB for MySQLへのアクセスを希望します。
**解決方法：**セキュリティグループのルールを追加するとき、【タイプ】からMySQL(3306)を選択して、3306号プロトコルのポートを開きます。
実際の需要に応じて、すべてのIPまたは指定したIP（IP区分）を開いて、CVMを介してTencentDB for MySQLにアクセスできるIPソースを設定します。

| 方向 | タイプ | ソース | プロトコルポート | ポリシー |
|---------|---------|---------|---------|---------|
| 入力方向 | MySQL(3306)  | すべてのIP：0.0.0.0/0<br>指定IP：指定したIP またはIP区分を入力 | TCP:3306 | 許可 |


### 手順3：セキュリティグループの設定
セキュリティグループは、Tencent Cloudが提供するインスタンスクラスのファイアウォールで、クラウドデータベースのインバウンドトラフィックの制御を行うことができます。インスタンスの購入時でもセキュリティグループをバインドでき、購入後でもコンソールでセキュリティグループをバインドできます。

>!現在のTencentDB for MySQLのセキュリティグループは、**Virtual Private Cloudクラウドデータベース**の設定のみをサポートします。

1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストでインスタンスIDをクリックして、インスタンス管理ページに進みます。
2. インスタンス管理ページで【セキュリティグループ】ページを選択し、【セキュリティグループの設定】をクリックします。
3. ポップアップで表示されたダイアログボックスで、バインドするセキュリティグループを選択し、【確定】をクリックすると、クラウドデータベースへのセキュリティグループのバインドが完了します。 

## セキュリティグループのルールのインポート
1. [セキュリティグループのページ](https://console.cloud.tencent.com/cvm/securitygroup)で、必要なセキュリティグループを選択し、セキュリティグループのID/名称をクリックします。
2. インバウンド/アウトバウンドルールタブで【ルールのインポート】をクリックします。
3. ポップアップで表示されたダイアログボックスで、編集済みのインバウンド/アウトバウンドルールテンプレートファイルを選択して、【インポート開始】をクリックします。
>? ルールをインポートしたいセキュリティグループ内にすでにセキュリティグループのルールがある場合は、現在あるルールを先にエクスポートすることをお勧めします。既存のものがあると、新ルールをインポートするとき、元のルールに上書きすることになります。

## セキュリティグループのクローン作成
1. [セキュリティグループのページ](https://console.cloud.tencent.com/cvm/securitygroup)のリストの「操作」列で【その他】≻【クローン】を選択します。
2. ポップアップで表示されたダイアログボックスで、対象リージョン、対象プロジェクトを選択後、【OK】をクリックします。新しいセキュリティグループがCVMを関連付けする必要がある場合は、改めてセキュリティグループ内のCVM管理を行ってください。

## セキュリティグループの削除
1. [セキュリティグループのページ](https://console.cloud.tencent.com/cvm/securitygroup)で、削除するセキュリティグループを選択して、「操作」列で【その他】≻【削除】を選択します。
2. ポップアップで表示されたダイアログボックスで、【OK】をクリックします。現在のセキュリティグループに関連するCVMがある場合、セキュリティグループを先に解除すれば、削除できます。

