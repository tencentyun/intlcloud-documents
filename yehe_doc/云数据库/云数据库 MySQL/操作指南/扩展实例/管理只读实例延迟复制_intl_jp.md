ここでは、MySQLコンソールを介して読み取り専用インスタンス遅延レプリケーションの設定と、レプリケーションの起動/停止の方法についてご紹介します。遅延レプリケーション（読み取り専用インスタンスとマスターインスタンス間の遅延）を設定し、遅延中に指定した時間またはGTID（Global Transaction ID）までのリカバリを起動するように選択することで、効率的なデータのロールバックと障害の高速なバックトレースを実現できます。
- 遅延レプリケーション：読み取り専用インスタンスとマスターインスタンス間の遅延レプリケーション時間の設定をサポートします。
- レプリケーションの起動/停止：読み取り専用インスタンスとマスターインスタンス間のデータ同期を手動で起動または停止できるようにサポートします。

## 遅延レプリケーションの説明
- 読み取り専用インスタンスが遅延レプリケーションを有効化した後、読み取り専用インスタンスは読み取り専用グループから削除され、重みは0に設定されます。同時に、読み取り専用インスタンスが削除されるアラームがトリガーされます。 このとき、読み取り専用グループのVIPアドレスを使用してアクセスすると、トラフィックは削除された読み取り専用インスタンスに転送されず、読み取り専用インスタンスのVIPアドレスでしかアクセスできなくなります。
- 読み取り専用グループで遅延排除機能が有効化された状態で、読み取り専用インスタンスが遅延レプリケーションをオフにした後、読み取り専用インスタンスの遅延時間が読み取り専用グループの遅延しきい値よりも小さい場合に限り、読み取り専用インスタンスの重みが回復し、重みが回復すると同時に、読み取り専用インスタンスの削除回復のアラームがトリガーされます。
- データの指定した位置でのレプリケーションを起動している間は、再起動、設定の変更、バージョンアップ、カーネルマイナーバージョンのバージョンアップの操作を同時に行うことができません。

## 遅延レプリケーションの有効化
>?読み取り専用インスタンス「遅延レプリケーション」はデフォルトでは「無効状態」で、有効化すると遅延レプリケーションの時間が表示されます。
>
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストのインスタンスIDまたは「操作」の列の【管理】をクリックし、インスタンス詳細ページに進みます。
2. インスタンス詳細ページの「遅延レプリケーション」で、【有効化】をクリックします。
![](https://main.qcloudimg.com/raw/23a113ccd7251b379c8de124f0f945d1.png)
3. ポップアップしたダイアログボックスで、遅延時間を設定した後、【OK】をクリックします。
>?遅延時間の範囲値：1秒 - 3600 * 24 * 3秒。

## 遅延レプリケーションの変更
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストでインスタンスIDをクリックして、インスタンス詳細ページに進みます。
2. インスタンス詳細ページの「遅延レプリケーション」で、【変更】をクリックします。
![](https://main.qcloudimg.com/raw/83288194d58e25b6a3bd84f950a2ae5a.png)
3. ポップアップしたダイアログボックスで、遅延時間を設定した後、【OK】をクリックします。
![](https://main.qcloudimg.com/raw/40045317eb248fbfdb8b507bea550bdf.png)

## 遅延レプリケーションの無効化
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストでインスタンスIDをクリックして、インスタンス詳細ページに進みます。
2. インスタンス詳細ページの「遅延レプリケーション」で、【無効化】をクリックします。
3. ポップアップしたダイアログボックスで、誤りがないことを確認し、【OK】をクリックします。
>?遅延レプリケーションを無効化すると、遅延レプリケーション時間が0秒になり、読み取り専用インスタンスとマスターインスタンスの間でデータのリアルタイム同期が復旧されます。 
> 

## データレプリケーションの起動
>?読み取り専用インスタンス「レプリケーション状態」はデフォルトでは「正常」です。ユーザーが遅延レプリケーションを設定し、かつ遅延レプリケーションの時間帯に誤ってデータを削除した場合、誤った操作をした時の位置とGTIDによって、読み取り専用インスタンスはバイナリーログファイルの位置またはGTID以前にレプリケーションすることができ、すばやいデータ復旧の機能を実現します。
>
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストでインスタンスIDをクリックして、インスタンス詳細ページに進みます。
2. インスタンス詳細ページ下部の「レプリケーション状態」で、【起動】をクリックします。
![](https://main.qcloudimg.com/raw/83288194d58e25b6a3bd84f950a2ae5a.png)
3. ポップアップしたダイアログボックスで、起動方式などを選択し、【OK】をクリックします。
 - **正常起動**：レプリケーションが起動すると、読み取り専用インスタンスとマスターインスタンス間のデータ同期が復旧されます。
 - **指定位置へのレプリケーションを起動**：具体的なタイムポイントと対応するGTIDへの起動をサポートします。具体的なタイムポイントまたは対応するGTIDへ復旧後、読み取り専用インスタンスは通常の起動方式に切り替わるまでその後のレプリケーションを停止し、切り替え後にレプリケーションを継続します。
    - 時間：選択できる時間範囲は、レプリケーションを停止した時間からマスターデータベースの現在時刻までの時間帯です。
    - GTID：選択できる範囲は読み取り専用インスタンスの適用が終わっていないバイナリーログ以降のすべてのログです。インスタンスのserver_uuidの長さは規定され、かついずれも36ビットとし、GTIDのフォーマットは`server_uuid::transaction_id`である必要があります。
   >!
   >- 入力されたバイナリーログの位置がすでに読み取り専用インスタンスで適用、またはマスターインスタンスのポイントよりも大きい場合は、レプリケーションの起動に失敗する恐れがあります。
   >- レプリケーション起動時に、バイナリーログに中断が存在する場合は、レプリケーションの起動に失敗する恐れがあります。
   >- 遅延した読み取り専用インスタンスがレプリケーションプロセスを停止し、読み取り専用インスタンスのディスク容量の超過を招くことを避けるため、読み取り専用インスタンスのディスク容量が5GB未満の場合は、読み取り専用インスタンスのIOスレッドを一時停止します。
   > 
![](https://main.qcloudimg.com/raw/2422edcaa53a5cc50089f5c3748eef28.png)

## データレプリケーションの停止
>?
>- 遅延レプリケーション機能が有効な場合にのみ、レプリケーション停止機能の操作が認められ、そうでなければ「停止」ボタンは使用できない状態となります。
>- レプリケーションの停止と同時にio/sqlスレッドも停止されます。
>
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストでインスタンスIDをクリックして、インスタンス詳細ページに進みます。
2. インスタンス詳細ページ下部の「レプリケーション状態」で、【停止】をクリックします。
![](https://main.qcloudimg.com/raw/8921d228b70bf42ca5120d6fcf44e92c.png)
3. ポップアップしたダイアログボックスで、誤りがないことを確認し、【OK】をクリックします。

## よくあるご質問
#### どのようにGTIDを取得しますか。
flush logコマンドを実行してbinlogファイルを取得し、誤操作時の位置とGTIDを特定することをお勧めします。

#### どのように遅延時間を確認しますか。
[コンソール](https://console.cloud.tencent.com/cdb) のインスタンス詳細ページで、読み取り専用インスタンスとマスターインスタンスの遅延時間を確認できます。
![](https://main.qcloudimg.com/raw/0b975dfca0c575735b94445f11e30d67.png)

#### どのように指定位置へのレプリケーション起動のタスク情報を確認しますか。
[コンソール](https://console.cloud.tencent.com/cdb) のタスクリストページで、タスクの進捗状況と詳細を確認できます。
![](https://main.qcloudimg.com/raw/f3c0cb3ed4d9488c66fc02cbd96b770d.png)

