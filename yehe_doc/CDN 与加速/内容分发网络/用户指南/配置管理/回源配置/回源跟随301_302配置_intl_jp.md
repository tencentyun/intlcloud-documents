## 設定シナリオ
Tencent Cloud CDNは、デフォルトでは301/302ステータスコードをキャッシュしません。オリジンサーバーから301/302リクエストを返すと、CDNノードはデフォルトでクライアントに応答を返し、クライアントは対応するリソースにリダイレクトされアクセスします。

301/302リダイレクト設定を有効にすることで、CDNノードは、必要なリソースを取得するまで、back-to-origin中に301/302リダイレクト要求を受信するとリダイレクトされます（最大3回フォロー可能）。実際のリソースをクライアントに返し、クライアントでリダイレクトする必要はありません。
## 設定ガイド
### 設定の確認
[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、左側のナビゲーションメニューバーで【ドメイン管理】を選択して、ドメイン名の右側にある【管理】をクリックすると、ドメイン名設定画面に入ります。第4欄の【back-to-origin設定】タブで、back-to-originフォロー301/302設定を確認できます。デフォルトでは無効になっています。
![](https://main.qcloudimg.com/raw/3d431956857ef20b21bb954e481c66e4.png)

### 設定の変更
301/302リダイレクト設定スイッチを切り替えて、この機能を有効または無効にできます。
![](https://main.qcloudimg.com/raw/cbbd0f472a50287fd425cd093a2dacb9.png)

>アクセラレーションドメイン名がグローバルアクセラレーション用に設定されている場合、設定された301/302リダイレクト設定がグローバルに有効になります。中国本土と中国本土以外との異なる設定に対応しません。

## 設定例
ドメイン名`cloud.tencent.com`の301/302リダイレクト設定は以下のとおりです。
![](https://main.qcloudimg.com/raw/cbbd0f472a50287fd425cd093a2dacb9.png)
ユーザーAがリソース`http://cloud.tencent.com/1.jpg`をリクエストします。キャッシュがノードでヒットしない場合、ノードはオリジンサーバーにリクエストして必要なリソースを取得します。オリジンサーバーから返されたHTTP Response ステータスコードが302であり、リダイレクト先アドレスが`http://cloud.tencent.com/1.jpg`の場合、次のようになります。

1. 301/302リダイレクト設定を有効にした後に、ノードは301/302ステータスコードを含むHTTP応答を受信すると、リダイレクト指向アドレスへ直接にリクエストを送信します。
2. 必要なリソースを取得し、ノードにキャッシュしてから、ユーザーに返されます。
3. この時に、ユーザーBも`http://cloud.tencent.com/1.jpg`に対しリクエストを送信すると、キャッシュがノードでヒットし、リソースがユーザーに返されます。
4. 301/302リダイレクト設定を有効にすると、最大3回までのリダイレクトをフォローできます。この制限を超えると、301/302ステータスコードがユーザーに返されます。

ドメイン名`cloud.tencent.com`の301/302リダイレクト設定は以下のとおりです。
![](https://main.qcloudimg.com/raw/3d431956857ef20b21bb954e481c66e4.png)
ユーザーAがリソース`http://cloud.tencent.com/1.jpg`をリクエストしますが、キャッシュがノードでヒットしない場合、ノードはオリジンサーバーにリクエストして必要なリソースを取得します。オリジンサーバーから返されたHTTP応答ステータスコードが301/302で、リダイレクト先アドレスが`http://xxx.tencent.com/1.jpg`の場合、次のようになります。
1. ノードはユーザーにHTTP応答を直接返します。
2. ユーザーが`http://xxx.tencent.com/1.jpg`に対しリクエストを送信し、当該ドメイン名がCDNにアクセスしていない場合、アクセラレーションは有効になりません。
3. この時に、ユーザーBも`http://cloud.tencent.com/1.jpg` に対しリクエストを送信すると、上記プロセスが繰り返されます。

