CLBはレイヤー4（TCPプロトコル/UDPプロトコル/TCP SSLプロトコル）およびレイヤー7（HTTPプロトコル/HTTPSプロトコル）のロードバランサです。CLBは業務トラフィックを複数のバックエンドサーバーに分配することで、単一点障害を解消して業務の可用性を保障します。CLB自体がクラスターデプロイを用いることで、セッションの同期を実現し、サーバーの単一点障害を解消し、システムの冗長性を高め、サービスの安定性を保証することができます。同一リージョン内に複数のデータセンターをデプロイすることで、同一都市内障害復旧を実現できます。

## インフラストラクチャ
Tencent Cloud CLBは現在、レイヤー4およびレイヤー7のロードバランシングサービスをご提供しています。
- レイヤー4では主に、Tencentが自社開発した統合アクセスゲートウェイ（Tencent Gateway、TGW）によって負荷分散を実現しています。TGWは高い信頼性、強力な拡張性、ハイパフォーマンス、高い攻撃防御力などの特徴を備え、Data Plane Development Kit（DPDK）によるハイパフォーマンスな転送をサポートします。単一のクラスターで億単位の同時接続、1000万単位のPPSをサポート可能です。Tencent Games、Tencent Video、WeChat、QQ などのTencent内部のさまざまな業務はすべてTGW によってサービスにアクセスしています。
- レイヤー7では主にSecure Tencent Gateway（STGW）によって負荷分散を実現しています。STGWはTencentがNginxをベースに自社開発した、大規模同時接続をサポートするレイヤー7ロードバランシングサービスであり、Tencent News、理財通、Tencent Games、WeChatなどのTencent内部の大量のレイヤー7業務トラフィックを支えています。
![](https://main.qcloudimg.com/raw/c2607a45aec0366af276f70e65722f4c.png)

## 転送パス
CLBは業務トラフィックの転送を行い、バックエンドサービスが業務リクエストを実際に処理します。CLBとバックエンドCVMの間の通信はTencent Cloudプライベートネットワークによって行います。TGWとSTGWはどちらも複数のサーバーにデプロイし、クラスターによってロードバランシングサービスを提供します。CLBの転送パスは下図のとおりです。
![](https://staticintl.cloudcachetci.com/yehe/backend-news/Bzmv359_%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230323115443.png)
1. TCP/UDPプロトコル：
 - TCP/UDPプロトコルの転送ロジックはTGWクラスターによって処理されます。
 - 業務トラフィックが到達すると、TGWがTencent Cloudプライベートネットワークを経由してバックエンドCVMに転送し、バックエンドCVMのリターンパケットもTGWを経由してクライアントに返されます。
2. TCP SSLプロトコル
 - TCP SSLプロトコルの処理の際、業務トラフィックはまずTGWクラスターを通過し、その後STGWクラスターからバックエンドCVMに転送されます。
 - セッションを新規作成する際は、アクセラレーターカードクラスターによる証明書の検証および暗号化と復号などの事前操作を経る必要があります。
 - 業務トラフィックが到達すると、Tencent Cloudプライベートネットワーク内で、順にTGW、STGW、バックエンドCVMを通過します。リターンパケットも逆方向に順次クライアントに返されます。
3. HTTP/HTTPSプロトコル
 - HTTP/HTTPSプロトコルの処理の際、業務トラフィックはまずTGWクラスターを通過し、その後STGWがHTTPプロトコルを認識してバックエンドCVMに転送します。
 - HTTPSセッションを新規作成する際は、アクセラレーターカードクラスターによる証明書検証および暗号化と復号などの事前操作を経てから、HTTPSをHTTPプロトコルに変換し、バックエンドCVMに転送する必要があります。
 - 業務トラフィックが到達すると、Tencent Cloudプライベートネットワーク内で、順にTGW、STGW、バックエンドCVMを通過します。リターンパケットも逆方向に順次クライアントに返されます。
