### アクセス監視の帯域幅データはどのように統計されていますか。
各CDNノードはリアルタイムでトラフィックデータを収集し、コンピューティングセンターに報告してドメイン名の総トラフィックデータに集計します。時間の期間によって、総トラフィックを使用時間で割って帯域幅統計を表示します。
**例えば：**
- 1分間に発生したトラフィックの合計は6MBである場合、対応する帯域幅は（6 * 8）/60 = 0.8Mbpsとなります。
- 帯域幅課金には5分間粒度のデータで決済すると、対応する帯域幅の値=5分間粒度の総トラフィック÷300秒となります。

### 監視情報のトラフィックとログによって計算されたトラフィックに違いがあるのはなぜですか、違いは何ですか。
アクセラレーションドメイン名のログに記録されているダウンストリームバイトによって統計されたトラフィックデータは、アプリケーション層のデータです。実際のネットワーク転送において生成するネットワークトラフィックは純粋なアプリケーション層のトラフィックよりも約5〜15％多くなります。
- TCP/IPヘッダーによる消費：TCP/IPプロトコルに基づくHTTPリクエストでは、各パケットのサイズは最大1500バイトであり、TCPとIPプロトコルの40バイトのヘッダーが含まれます。ヘッダー部にトラフィックが生成しますが、アプリケーション層に統計されません。この部分のオーバーヘッドは約3%です。
- TCP再送信：ネットワークを介した通常のデータ転送中に、送信されるネットワークパケットの約3%～10%はインターネット上で廃棄されます。サーバーは廃棄された部分を再送信しますが、アプリケーション層はこの部分にかかったトラフィックを統計できません。このタイプのトラフィックは、総トラフィックの約3%～7%を占めます。

業界標準では、課金可能なトラフィックは、一般的にアプリケーション層でカウントされたトラフィックとオーバーヘッドの合計です。Tencent Cloud CDNは10％を占めるため、監視トラフィックがログによって計算されるトラフィックの110%程度となります。

### トラフィックのヒット率はどのように計算しますか。
CDNは、デフォルトではユーザーにL2キャッシュ(エッジレイヤー、中間レイヤー)を有効にし、CDNのいずれかのレイヤーにヒットされ、リクエストに応答すると、CDNノードにヒットしていること見なされます。
トラフィックヒット率=（総ダウンストリームトラフィック-back-to-originトラフィック）/総ダウンストリームトラフィック。

### トラフィックのヒット率が低い問題を解決するにはどうすればよいですか。
- キャッシュ更新が行われたかどうかを確認します。キャッシュ更新により、ノードで指定されたコンテンツがクリアされ、一時的にトラフィックヒット率が低下します。
- オリジンサーバーに新しいリソースが追加されているかどうかを確認します。オリジンサーバーに新しいリソースが多い場合、CDNノードでback-to-originが発生して、トラフィックヒット率が低下する可能性があります。
- オリジンサーバーに異常がないかどうかを確認します。オリジンサーバーに障害が発生すると、5XXまたは4XXエラーが多くなった場合、トラフィックのヒット率に影響を与えます。
- キャッシュの有効期限ポリシーが正しく設定されているかどうかを確認します。コンソールの「キャッシュ設定」ページで「キャッシュの有効期限設定」セクションを表示します。キャッシュの有効期限ポリシーの優先順位は上から下へ、低から高へであり、即ち、下部のキャッシュポリシーは上部のキャッシュポリシーよりも優先されます。
- Range back-to-originが有効になっているかどうかを確認します。コンソールの「back-to-origin設定」ページで「Range back-to-origin」セクションを表示します。Range back-to-originが無効になっている場合、 back-to-origin時にファイル全体を引き出しますため、 back-to-originトラフィックが増加し、ヒット率が低下します。
- フィルターパラメーターが有効になっているかどうかを確認します。コンソールの「アクセス設定」ページで「フィルターパラメーター」セクションを表示します。フィルターパラメーターが無効になっている場合、フルパスに基づいてキャッシュが実行されます。同じリソースが異なるパラメーターによって要求される場合、マッチングできないと複数回キャッシュされるため、トラフィックの命中率に影響を与えます。

### ステータスコード統計にはすべてのステータスコードが含まれていますか。

はい。CDN統計分析の新しいバージョンが公開されると、オリジンサーバーで生成されたステータスコードさえあれば、対応する監視曲線が生成されます。トラブルシューティングのプロセスが容易になります。

### 省別、キャリア別の統計データはどのように計算しますか。
省別、キャリア別の統計データは、アクセスログのクライアントIPに基づいて計算されます。単純なログ計算を採用しているので、累積された課金対象データは、「すべての省」、「すべてのキャリア」が選択された場合の課金対象データとは異なります。詳細については、上記の質問2をご参照ください。


### CDN back-to-originトラフィックはどのように生成されますか。

CDN back-to-originトラフィックは、次の3つの状況で生成されます。
1.要求されたリソースはCDNノードにキャッシュされず、オリジンサーバーからプルされます。
2. 手動で更新されたオリジンサーバーはノードと同期されます。
3. オリジンサーバーは自動更新されます。

### CDNトラフィックに異常があるか、DDoSまたはCC攻撃を受けている場合はどうすればよいですか。

ビジネストラフィックがそれほど量に到達しないと思われる場合は、ログをダウンロードして、ビジネスのアクセス状況に基づいて関連するアクセス制限を設定できます。CDNではご利用のビジネスロジックを認識しないため、デフォルトではアクセス要求を制限することがありません。したがって、ビジネス状況に基づいて制限を設定する必要があります。詳細については、[ログのダウンロード](https://intl.cloud.tencent.com/document/product/228/6316)をご参照ください。

悪意のあるリクエストやWebサイトへのCC / DDoS攻撃を回避するために、次の設定を行うことを強くお勧めします。
1. リンク不正アクセス防止の設定：ビジネスリソースのアクセス元を制御し、ユーザーのHTTPリクエストヘッダーのrefererフィールドの値にアクセス制御ポリシーを設定することにより、アクセス元を制限し、悪意のあるユーザーからの盗用を防ぎます。詳細については、[リンク不正アクセス防止の設定](https://intl.cloud.tencent.com/document/product/228/6292)をご参照ください。
2. IPブラックリスト/ホワイトリストの設定：悪意のあるIPからの盗用や攻撃などの問題を解決するために、ビジネスニーズに応じて、ユーザーリクエストのソースIPにフィルタリングポリシーを設定できます。詳細については、[IPブラックリスト/ホワイトリストの設定](https://intl.cloud.tencent.com/document/product/228/6298)をご参照ください。
3. IPアクセス制限の設定：クライアントIPに対して、ノードごとの1秒あたりのアクセス回数を制限することにより、CC攻撃から防御できます。設定を有効にすると、QPS制限を超えるリクエストに対して514エラーが返されます。頻度制限を低く設定すると、通常の高頻度ユーザーの利用に影響する場合があるため、実際の業務状況やユースケースに応じて、適切なしきい値を設定してください。詳細については、[IPアクセス制限の設定](https://intl.cloud.tencent.com/document/product/228/6420)をご参照ください。
4. 帯域幅上限の設定：ドメイン名の帯域幅の上限を設定できます。特定の統計期間（5分）内にドメイン名で発生した帯域幅が指定されたしきい値を超えると、ユーザーの設定に従って、すべてのアクセス要求がオリジンサーバーに転送されるか、直接CDNサービスを無効にして、すべてのアクセス要求が404エラーが返されます。詳細については、[帯域幅上限の設定](https://intl.cloud.tencent.com/document/product/228/7541)をご参照ください。
