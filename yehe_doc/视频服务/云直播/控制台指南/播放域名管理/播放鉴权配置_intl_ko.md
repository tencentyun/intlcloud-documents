## 작업 시나리오   
CSS 콘텐츠는 기본적으로 공개 리소스이며, 재생 주소 획득 후 바로 라이브 방송 콘텐츠에 액세스할 수 있습니다. 라이브 방송 콘텐츠에 대한 액세스 제어가 필요한 경우 인증 설정을 통해 라이브 방송 리소스 콘텐츠를 보호할 수 있습니다.


## 설정 원리
URL 인증은 CSS 클라이언트가 인증 설정을 통해 암호화된 URL을 생성하고, 해당 URL을 사용자에게 제공하면 사용자가 암호화된 URL을 사용하여 CSS 가속 노드에 요청을 발송한 후 라이브 방송 가속 노드가 해당 권한 정보를 인증하여 요청의 적합성을 판단하는 원리입니다. 요청이 적합하면 정상적으로 콘텐츠를 반환하며, 요청이 적합하지 않는 경우 거절되어 라이브 방송 리소스를 보호할 수 있습니다.
 

## 전제 조건
- [CSS 콘솔](https://console.cloud.tencent.com/live)에 로그인되어 있어야 합니다.
- **재생 도메인**이 추가되어 있어야 합니다.

## 작업 순서
1. [**도메인 관리**](https://console.cloud.tencent.com/live/domainmanage)를 선택하여 인증 설정할 **재생 도메인** 또는 **관리**를 클릭해 도메인 관리로 이동합니다.
2. **액세스 제어** > **인증 설정**에서 **편집**을 클릭하여 인증 설정 페이지로 이동합니다.
3. 인증 설정 페이지에서 다음과 같이 설정합니다.
	1. 재생 인증 활성화를 클릭합니다.
	2. 사용자 정의 인증 메인 Key를 입력합니다. (예: `testlive`)
	3. 필요에 따라 사용자 정의 인증 서브 Key를 입력합니다. (예: `testing`)
	4. 서명 유효 시간을 입력합니다. (예: `20`)
	5. **저장**을 클릭하면 설정이 저장됩니다.

>?
>- 재생 도메인의 재생 인증은 기본적으로 **비활성화** 상태입니다.
> - **인증 Key**: 사용자 정의 설정할 수 있으며, 영문 대소문자와 숫자를 지원합니다. Key에는 메인 Key와 서브 Key가 있으며, 메인 Key는 필수 입력 사항이고 서브 Key는 선택 입력 사항입니다. 메인/서브 Key는 Key가 노출될 경우 원활한 Key 변경을 지원하여 비즈니스에 영향을 미치지 않습니다.
> - **유효 시간**: 서명의 유효 시간으로 타임스탬프는 16진법 UNIX 시간입니다.

![](https://main.qcloudimg.com/raw/b2dcc1a646a2e9e6c9bcac665aa5043c.png)
>! 재생 도메인의 인증 설정을 활성화하면 기존 재생 URL은 직접 액세스할 수 없게 되며 403이 반환됩니다. 라이브 방송 비즈니스에 영향이 미치지 않도록 해당 기능 활성화 시 귀하의 비즈니스가 다음의 인증 알고리즘과 호환되는지 확인하시기 바랍니다.

## 설정 사례
기존 재생 URL이 다음과 같습니다.
```
http://www.test.com/live/test01.flv
```

해당 도메인의 인증 매개변수를 다음과 같이 설정하는 경우,
```
메인 Key: ngoeiq03
서브 Key: 없음
유효 시간: 12495초
```

>! 
>- 도메인 인증을 활성화한 경우 실제 만료 시간은 txTime + Key 유효 시간입니다.
>- 콘솔에서는 사용 편의를 위해 설정하는 시간이 곧 실제 만료시간이 됩니다. **도메인 인증을 활성화한 경우 재생 주소 연산 시 공식에 따라 txTime을 역산출합니다**.
>- 푸시/풀 스트림은 만료 시간 이전에 수행되며, 푸시/풀 스트림이 끊어지거나 중지되지 않는 한 만료 시간 후에도 푸시/풀 스트림 상태를 정상적으로 유지할 수 있습니다.

타임스탬프 연산:
```
설정 시간: 2018.12.01 08:30:00
10진법 UNIX 타임스탬프: 1543624200
16진법 UNIX 타임스탬프: 5C01D608(CSS 인증 설정에는 16진법 UNIX 타임스탬프를 사용하며 16진법은 영문 대소문자를 구분하지 않음)
```

서명 인증 연산:
```
txSecret = MD5(key+StreamName+txTime) 
StreamName은 스트림 이름으로 StreamID와 동일한 개념입니다.
txTime은 타임스탬프입니다.
key는 인증 키입니다.
txSecret = MD5(ngoeiq03+test01+5C01D608)
txSecret = MD5(ngoeiq03test015C01D608)
txSecret = ce797dc6238156d548ef945e6ad1ea20
```

새로 생성된 재생 URL:
```
http://www.test.com/live/test01.flv?txSecret=ce797dc6238156d548ef945e6ad1ea20&txTime=5C01D608
```
해당 URL의 유효 시간 타임 스탬프는 2018.12.01 08:30:00 + 12495초입니다. 즉, 베이징 시간 2018.12.01 11:58:15입니다.
인증에 실패하거나 URL이 유효하지 않은 경우 CSS에서 403을 반환합니다.
