## 概要   
CSSのコンテンツは、デフォルトの状態では、リソースを公開し、再生アドレスを取得するとすぐにライブストリーミングコンテンツにアクセスできるようになります。ライブストリーミングコンテンツに対するアクセス制限を行いたい場合は、認証設定によりライブストリーミングリソースのコンテンツ保護を実現できます。


## 設定の原理
URL認証の原理は、CSSの顧客が認証設定により暗号化 URLを生成し、この URLをユーザーに提供するものです。ユーザーが暗号化 URLを採用してCSSアクセラレーションノードに対してリクエストを発信すると、CSSアクセラレーションノードがその権限情報を検証し、リクエストが合法かを判断します。リクエストが合法の場合は、正常にコンテンツを返し、リクエストが違法な場合は、拒否することでライブストリーミングリソースの保護を実現します。
 

##  前提条件
- [CSSコンソール](https://console.cloud.tencent.com/live)にログイン済みであること。
- **再生ドメイン名**を追加済みであること。

## 操作手順
1. [**ドメイン名管理**](https://console.cloud.tencent.com/live/domainmanage)を選択し、認証設定を行いたい**再生ドメイン名**または**管理**をクリックして、ドメイン名管理に進みます。
2. **アクセス制御**>**認証設定**で、**編集**をクリックして認証設定画面に進みます。
3. 認証設定画面で以下の設定を行います。
	1. 再生認証を「有効にする」をクリックします。
	2. カスタマイズした認証のプライマリKeyを入力します（例：`testlive`）。
	3. カスタマイズした認証のスタンバイKeyを入力します（例：`testing`）。
	4. 署名の有効時間を入力します（例：`20`）。
	5. **保存**をクリックすると、設定が保存されます。

>?
>- 再生ドメイン名の再生認証は、デフォルトの状態では**無効**になっています。
> - **認証 Key**：ユーザーによるカスタマイズ設定、大文字・小文字アルファベットおよび数字をサポートしています。KeyにはプライマリKeyとスタンバイKeyがあり、プライマリKeyは必須項目、スタンバイKeyは任意選択項目です。プライマリ/スタンバイKeyによって、Keyが漏洩したときにKeyをスムーズに交換でき、業務への影響を避けることができます。
> - **有効時間**：署名の有効時間。タイムスタンプは16進数UNIX時間です。

![](https://main.qcloudimg.com/raw/b2dcc1a646a2e9e6c9bcac665aa5043c.png)
>! 再生ドメイン名の認証設定を有効にすると、既存の再生URLには直接アクセスできなくなり、403が返ってきます。この機能を有効にするときは、お客様の業務が以下の認証アルゴリズムと互換性があることをしっかりと確認し、お客様のライブストリーミング業務に影響が出ないようにしてください。

## 設定の例
初期再生URLが次の場合：
```
http://www.test.com/live/test01.flv
```

このドメイン名に対して認証を設定するときのパラメータは次のとおりです。
```
プライマリKey：ngoeiq03
スタンバイKey：なし
有効時間：12495秒
```

>! 
>- ドメイン名認証を有効にしている場合、実際の期限はtxTime + Keyの有効時間と等しくなります。
>- コンソールでは、利用しやすいように、設定時間を実際の期限としています。**ドメイン名認証を有効にした場合、再生アドレスの計算時に、公式に基づきtxTimeが逆算されます**。
>- 有効期限までにプッシュプルストリームを行った場合、プッシュプルストリームが正常であり、中断や停止がなければ、有効期限が過ぎても正常なプッシュプルストリームの状態を維持することができます。

タイムスタンプの計算：
```
設定時間：2018.12.01 08:30:00
10進数UNIXタイムスタンプ：1543624200
16進数UNIXタイムスタンプ：5C01D608（CSS認証設定は16進数UNIXタイムスタンプを使用しています。16進数は大文字小文字の区別はありません）
```

認証署名の計算：
```
txSecret = MD5(key+StreamName+txTime) 
StreamName：ストリーム名。 StreamIDの概念と同じです
txTime：タイムスタンプ
key ：認証キー
txSecret = MD5(ngoeiq03+test01+5C01D608)
txSecret = MD5(ngoeiq03test015C01D608)
txSecret = ce797dc6238156d548ef945e6ad1ea20
```

新しく生成した再生URLは次のとおりです。
```
http://www.test.com/live/test01.flv?txSecret=ce797dc6238156d548ef945e6ad1ea20&txTime=5C01D608
```
このURLの有効時間は：2018.12.01 08:30:00 + 12495秒、北京時間：2018.12.01 11:58:15までです。
認証に通過しなかったか、またはURLが失効している場合は、CSSが403を返します。
