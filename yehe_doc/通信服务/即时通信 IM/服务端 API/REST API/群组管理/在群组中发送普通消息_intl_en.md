## Feature Description
 Through this API, the app admin can send ordinary messages in a group.

## API Call Description
### Applicable group types

| Group Type ID | RESTful API Support |
|-----------|------------|
| Private | Yes. Same as Work (work group) in the new version. |
| Public | Yes. |
| ChatRoom | Yes. Same as Meeting (temporary meeting group) in the new version. |
| AVChatRoom | Yes. |


Above are the IM built-in groups. For more information, see [Group system](https://intl.cloud.tencent.com/document/product/1047/33529).

### Sample request URL
```
https://console.tim.qq.com/v4/group_open_http_svc/send_group_msg?sdkappid=88888888&identifier=admin&usersig=xxx&random=99999999&contenttype=json
```
### Request parameters

The following table only describes the modified parameters when this API is called. For more information on other parameters, please see [RESTful API Overview](https://intl.cloud.tencent.com/document/product/1047/34620).

| Parameter | Description |
| ------------------ | ------------------------------------ |
| v4/group_open_http_svc/send_group_msg | Request API |
| sdkappid | The SDKAppID assigned by the IM console when an application is created. |
| identifier | Must be the app admin account. For more information, please see the **App Admin** section in [Login Authentication](https://intl.cloud.tencent.com/document/product/1047/33517). |
| usersig | The signature generated by the app admin account. For more information on the operation, please see [Generating UserSig](https://intl.cloud.tencent.com/document/product/1047/34385). |
| random | A random 32-bit unsigned integer ranging from 0 to 4294967295. |

### Maximum call frequency

200 calls per second

### Sample request packets

- **Basic Format**
The app admin sends ordinary group messages, and the sender is the app admin.
```
{
    "GroupId": "@TGS#2C5SZEAEF",
    "Random": 8912345, // A random number. If the random numbers of two messages are the same within five minutes, they are considered to be the same message.
    "MsgBody": [ // Message body, which consists of an element array. For details, see the field description.
        {
            "MsgType": "TIMTextElem", // Text
            "MsgContent": {
                "Text": "red packet"
            }
        },
        {
            "MsgType": "TIMFaceElem", // Emoji
            "MsgContent": {
                "Index": 6,
                "Data": "abc\u0000\u0001"
            }
        }
    ],
    "OfflinePushInfo": {
        "PushFlag": 0, // Normal push
        "Desc": "The content that is pushed offline",
        "Ext": "The passthrough content",
        "AndroidInfo": {
            "Sound": "android.mp3"
        },
        "ApnsInfo": {
            "Sound": "apns.mp3",
            "BadgeMode": 1, // If this parameter is not specified or is set to 0, the message is counted. If this parameter is set to 1, the message is not counted, that is, the icon number in the upper-right corner does not increase by 1.
            "Title":"apns title", // apns title
            "SubTitle":"apns subtitle", // apns subtitle
            "Image":"www.image.com" // Image URL
        }
    }
}
```
- **Specifying the Message Sender**
The app admin can specify a group member as the message sender in **From_Account**.
After receiving the message, other members will see that the message is sent from the group member specified by the app admin.
```
{
    "GroupId": "@TGS#2C5SZEAEF",
    "From_Account": "leckie", // The specified message sender (optional)
    "Random": 8912345, // A random number. If the random numbers of two messages are the same within five minutes, they are considered to be the same message.
    "MsgBody": [ // Message body, which consists of an element array. For details, see the field description.
        {
            "MsgType": "TIMTextElem", // Text
            "MsgContent": {
                "Text": "red packet"
            }
        },
        {
            "MsgType": "TIMFaceElem", // Emoji
            "MsgContent": {
                "Index": 6,
                "Data": "abc\u0000\u0001"
            }
        }
    ]
}
```
- **Specifying the Message Priority**
You can specify the message priority. The default priority is Normal.
There are three priority options in descending order: High, Normal, and Low. They are case-sensitive.
```
{
    "GroupId": "@TGS#2C5SZEAEF",
    "Random": 8912345, // A random number. If the random numbers of two messages are the same within five minutes, they are considered to be the same message.
    "MsgPriority": "High", // Message priority
    "MsgBody": [ // Message body, which consists of an element array. For details, see the field description.
        {
            "MsgType": "TIMTextElem", // Text
            "MsgContent": {
                "Text": "red packet"
            }
        },
        {
            "MsgType": "TIMFaceElem", // Emoji
            "MsgContent": {
                "Index": 6,
                "Data": "abc\u0000\u0001"
            }
        }
    ]
}
```
- **Forbidding Callback for a Message**
When the callback switch is turned on, users can specify **ForbidCallbackControl** to control whether to initiate callback for a single message. By default, callback is initiated.
```
{
    "GroupId": "@TGS#2C5SZEAEF",
    "Random": 8912345, // A random number. If the random numbers of two messages are the same within five minutes, they are considered to be the same message.
    "ForbidCallbackControl":[
		    "ForbidBeforeSendMsgCallback",
		    "ForbidAfterSendMsgCallback"], // Callback forbidding control options
    "MsgBody": [ // Message body, which consists of an element array. For details, see the field description.
        {
            "MsgType": "TIMTextElem", // Text
            "MsgContent": {
                "Text": "red packet"
            }
        },
        {
            "MsgType": "TIMFaceElem", // Emoji
            "MsgContent": {
                "Index": 6,
                "Data": "abc\u0000\u0001"
            }
        }
    ]
}
```
- **Sending group @ messages**
  The target @ users set in the GroupAtInfo field have a one-to-one and sequential correspondence to the target @ users in the message body.

  ```
      {
          "GroupId": "@TGS#2C5SZEAEF",
          "Random": 8912345, // A random number. If the random numbers of two messages are the same within five minutes, they are considered to be the same message.
          "MsgBody": [ // Message body, which consists of an element array. For details, see the field description.
              {
                  "MsgType": "TIMTextElem", // Text
                  "MsgContent": {
                      "Text": "red @all @tommy @brennanli packet"
                  }
              }
          ],
          //It corresponds to @all @tommy @brennanli in the text information.
          "GroupAtInfo":[
          {
              "GroupAtAllFlag":1 //1: @all. 0: @ a certain group member
          },
          {
              "GroupAtAllFlag":0,
              "GroupAt_Account":"tommy" // @ a specific group member
          },
          {
              "GroupAtAllFlag":0,
              "GroupAt_Account":"brennanli"
          }
  	 ]    
      }
  ```


- **Specifying Messages for Online Delivery Without Offline or Roaming Retention**
If **OnlineOnlyFlag** in the message body is set to a value greater than 0, it indicates that the message is for online delivery only, not for offline or roaming retention (AVChatRooms and BChatRooms do not allow this use).
```
    {
        "GroupId": "@TGS#2C5SZEAEF",
        "Random": 8912345, // A random number. If the random numbers of two messages are the same within five minutes, they are considered to be the same message.
        "OnlineOnlyFlag": 1, // It indicates that the message is for online delivery only (only online group members will receive it), not for offline or roaming retention.
        "MsgBody": [ // Message body, which consists of an element array. For details, see the field description.
            {
                "MsgType": "TIMTextElem", // Text
                "MsgContent": {
                    "Text": "red packet"
                }
            },
            {
                "MsgType": "TIMFaceElem", // Emoji
                "MsgContent": {
                    "Index": 6,
                    "Data": "abc\u0000\u0001"
                }
            }
        ]
    }
```


### Request packet fields

| Field | Type | Property | Description |
|---------|---------|---------|---------|
| GroupId | String | Required | The ID of the group to which the message will be sent. |
| Random | Integer | Required | A 32-bit unsigned integer. If the random numbers of two messages within five minutes are the same, the later message will be discarded as a repeated message. |
| MsgPriority | String | Optional | Message priority |
| MsgBody | Array | Required | The body of the message. For more information, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527). |
| From_Account | String | Optional | Message source account, optional. If this field is not specified, by default the message sender is the app admin account used to call the API. Alternatively, apps can specify the message sender in this field to implement some special features. Note that if this field is specified, you must ensure that the account in this field exists. |
| OfflinePushInfo | Object | Optional | The information to be pushed offline. For more information, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527). |
| ForbidCallbackControl | Array | Optional | Message callback forbidden switch, valid only for a single message. ForbidBeforeSendMsgCallback indicates that callback before sending the message is forbidden; ForbidAfterSendMsgCallback indicates that callback after sending the message is forbidden. |
| OnlineOnlyFlag | Integer | Optional | 1: send to online members only. 0 (default value): send to all members. This parameter is not supported by audio-video groups (AVChatRoom). |

### Sample response packet
```
{
    "ActionStatus":"OK",
    "ErrorInfo":"",
    "ErrorCode": 0,
    "MsgTime": 1497249503,
    "MsgSeq": 1
}
```

### Response packet fields

| Field | Type | Description |
|---------|---------|---------|
| ActionStatus | String | The request result. `OK`: succeeded. `FAIL`: failed |
| ErrorCode | Integer | The error code. `0`: succeeded. Other values: failed |
| ErrorInfo | String | The error information |
| MsgTime | Integer | Message sending timestamp, corresponding to the backend server time |
| MsgSeq | Integer | Message sequence number, the unique identifier of a message |

## Error Codes
The returned HTTP status code for this API is always 200 unless a network error (such as error 502) occurs. The specific error code and details can be found in the response fields `ErrorCode` and `ErrorInfo` respectively.
For public error codes 60000 to 79999, please see [Error Codes](https://intl.cloud.tencent.com/document/product/1047/34348).
The following table describes the error codes specific to this API.

| Error Code | Description |
|---------|---------|
| 10002 | Internal error of the server. Please retry. |
| 10004 | Invalid parameter. Check the error description and troubleshoot the issue. |
| 10007 | Insufficient permissions. For example, to remove someone from a public group requires administrator permissions. |
| 10010 | The group does not exist or has been deleted. |
| 10015 | The group ID is invalid. Please check the group ID. |
| 10016 | The app backend rejected this operation through a third-party callback. |
| 10017 | The message cannot be sent due to muting. Check whether the sender is muted. |
| 10023 | The message exceeds the frequency limit. Try again later. |
| 80001 | Text security filtering. Check whether the message text contains sensitive words. |
| 80002 | The message content is too long. Currently, the maximum message length supported is 8,000 bytes. Please adjust the message length. |

## API Debugging Tool
Use the [online RESTful API debugging tool](https://avc.cloud.tencent.com/im/APITester/APITester.html#v4/group_open_http_svc/send_group_msg) to debug this API.

## References

- Sending System Messages in a Group ([v4/group_open_http_svc/send_group_system_notification](https://intl.cloud.tencent.com/document/product/1047/34958))
- Sending a One-to-One Messages to One User ([v4/openim/sendmsg](https://intl.cloud.tencent.com/document/product/1047/34919))
- Sending One-to-One Messages to Multiple Users ([v4/openim/batchsendmsg](https://intl.cloud.tencent.com/document/product/1047/34920))
- [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527)


## Possible Callback
 [Callback before delivering group message](https://intl.cloud.tencent.com/document/product/1047/34375)
