## 작업 시나리오
다대일 동기화는 여러 원본 데이터베이스의 콘텐츠를 하나의 대상 데이터베이스에 동기화하는 것입니다. 단일 데이터베이스를 사용하는 경우 높은 부하 또는 리전 문제로 인해 데이터를 샤딩해야 하는 경우가 많지만 동일한 유형의 데이터베이스/테이블을 여러 데이터베이스에 저장하면 데이터 쿼리가 불편합니다. 다대일 동기화 기능을 사용하면 이 문제를 쉽게 해결할 수 있습니다.

다대일 동기화 작업은 다대일 토폴로지를 구축하기 위한 여러 단방향 동기화 작업으로 구성되므로 단방향 동기화 및 관련 작업에 대한 제한 사항을 따라야 합니다. 자세한 내용은 [데이터 동기화](https://cloud.tencent.com/document/product/571/58672)에서 적절한 동기화 시나리오를 참고하십시오.

## 주의 사항
- 전체 데이터 동기화 중에 DTS는 특정 원본 데이터베이스 리소스를 사용하므로 원본 데이터베이스의 로드와 압력이 증가할 수 있습니다. 데이터베이스 구성이 낮으면 사용량이 적은 시간에 데이터를 동기화하는 것이 좋습니다.
- 데이터 중복을 방지하려면 동기화할 테이블에 기본 키 또는 null이 아닌 고유 키가 있어야 합니다. 
- 데이터를 미리 계획해야 합니다. 각 원본 데이터베이스는 기본 키 충돌 및 동일한 기본 키로 데이터의 상호 덮어쓰기와 같은 문제를 방지하기 위해 서로 다른 기본 키로 데이터를 업데이트(추가, 삭제 및 수정)해야 합니다. 비즈니스 상의 이유로 여러 원본 데이터베이스에 중복 기본 키가 있는 경우 [일반적인 사용 사례에 대한 권장 구성](#tjpz)의 지침에 따라 적절한 충돌 해결 방법을 선택하여 동기화 동작 및 데이터가 기대치를 충족하도록 합니다.

## 제한
- 여러 동기화 작업의 구성에서 DDL 문은 원형 링크를 형성하지 않아야 합니다.
- 현재 MySQL, TDSQL-C(MySQL 버전 호환) 또는 양자 간의 다대일 동기화 작업만 지원됩니다.

## DDL 설정 원칙
- 여러 동기화 작업의 구성에서 DDL 문은 원형 링크를 형성해서는 안 됩니다. 그렇지 않으면 시스템에서 반복되어 오류가 발생합니다.
- 대상 데이터베이스의 동일한 테이블 객체는 여러 원본 데이터베이스에서 DDL 동기화를 수신할 수 없습니다. 그렇지 않으면 이러한 DDL 문이 대상 데이터베이스에서 서로 충돌하여 오류를 일으킬 수 있습니다.
   - 동일한 이름의 여러 테이블을 하나로 결합하는 다대일 동기화에서는 하나의 동기화 작업에서만 DDL을 선택할 수 있습니다.
   - 다른 유형의 다대일 동기화 작업(예: 이름이 다른 여러 테이블을 하나의 데이터베이스로 결합하는 작업)에서는 각 작업에서 DDL을 선택할 수 있습니다. 이 경우 실제 조건에 따라 적절한 DDL 동기화 정책을 선택합니다.
- 확인하는 동안 동기화 시스템은 생성 중인 동기화 작업이 다른 모든 동기화 작업을 기반으로 DDL 루프 또는 충돌을 일으킬 것인지 판단하고 참고를 위한 프롬프트를 제공합니다. 

## [일반적인 사용 사례를 위한 권장 구성](id:tjpz)
다대일 동기화 작업은 다대일 토폴로지를 설정하기 위한 여러 단방향 동기화 작업으로 구성됩니다. 각 단방향 동기화 작업의 생성 단계는 일반 단방향 동기화 작업의 생성 단계와 유사합니다. 다음 동기화 옵션 설정에서만 다릅니다.
다음 구성은 참고용으로 일반적인 사용 사례에 권장됩니다.

예: 데이터베이스 A, B 및 C 간의 동기화 작업을 생성해야 합니다. 여기서 데이터베이스 A 및 B에는 데이터베이스 C에 동기화해야 하는 동일한 이름의 테이블이 있고, 작업1은 A > C로의 동기화, 작업2는 B > C로의 동기화입니다. 더 많은 원본 데이터베이스의 데이터를 대상 데이터베이스로 동기화하려면 작업2를 참고하여 동기화 작업을 추가하기만 하면 됩니다.

<table>
<tr><th width="15%">시나리오</th> <th width="13%">시간 요건</th> <th width="10%">동기화 작업</th><th width="12%">초기화 유형</th><th width="13%">대상이 이미 있는 경우</th><th width="17%">충돌 해결 방법</th><th width="15%">동기화 작업 유형</th></tr>
<tr>
<td rowspan="2">시나리오1: 데이터베이스 A와 B에는 데이터베이스/테이블 구조와 데이터가 있고 데이터베이스 C는 비어 있습니다.</td><td rowspan="2">작업2는 작업1이 ‘증분 동기화’ 단계에 들어간 후에만 시작할 수 있습니다.</td><td>작업1</td><td>구조 초기화 + 전체 데이터 초기화</td><td>무시하고 실행</td><td rowspan="6">필요에 따라 옵션을 선택합니다.<li>예: 기본 키 충돌이 발생하고 데이터베이스 A의 콘텐츠가 우선 적용되도록 하려면 작업1에 대해 덮어쓰기를 선택하고 작업2에 대해 무시 또는 보고를 선택해야 합니다.</li><li>충돌 해결 방법은 기본 키 충돌이 있는 데이터에만 적용됩니다.</li></td><td rowspan="6"><li>최대 하나의 작업에서 DDL을 선택하십시오.</li><li>DDL이 아닌 작업 유형의 경우 다른 여러 작업 간에 일관성을 유지하십시오.</li></td></tr>
<tr>
<td>작업2</td><td>전체 데이터 초기화</td><td>무시하고 실행</td></tr>
<tr>
<td rowspan="2">시나리오 2: 데이터베이스 A와 B에는 데이터베이스/테이블 구조와 데이터가 있고 데이터베이스 C에는 데이터베이스/테이블 구조만 있고 데이터는 없습니다.</td><td rowspan="2">없음</td><td>작업1</td><td>전체 데이터 초기화</td><td>무시하고 실행</td></tr>
<tr>
<td>작업2</td><td>작업1과 동일</td><td>작업1과 동일</td></tr>
<tr>
<td rowspan="2">시나리오3: 데이터베이스 A, B, C에 모두 데이터베이스/테이블 구조와 데이터가 있습니다.</td><td rowspan="2">없음</td><td>작업1</td><td>전체 데이터 초기화</td><td>무시하고 실행</td></tr>
<tr>
<td>작업2</td><td>작업1과 동일</td><td>작업1과 동일</td></tr>   
</table>

## 작업 단계
다음은 MySQL 2대1 동기화(데이터베이스 A와 B에는 데이터베이스/테이블 구조와 데이터가 있고 데이터베이스 C는 비어 있음)를 예로 사용합니다. 다른 데이터베이스에 대한 다대일 동기화 작업도 비슷합니다.

### 동기화 작업1 생성(데이터베이스 A > 데이터베이스 C)
1. [데이터 동기화 구매 페이지](https://buy.cloud.tencent.com/dts)에 로그인하여 알맞은 설정을 선택하고 **즉시 구매**를 클릭합니다.
<table>
<thead><tr><th>매개변수</th><th>설명</th></tr></thead>
<tbody><tr>
<td>결제 모드</td><td>월간 구독 및 종량제 청구 모드가 지원됩니다. 현재 데이터 동기화 기능은 무료이며, 공식적으로 청구가 시작되기 한 달 전에 이메일과 메시지 센터로 알림을 받게 됩니다.</td></tr>
<tr>
<td>원본 데이터베이스 유형</td><td>MySQL(TencentDB for MySQL 및 자체 구축 MySQL 포함)을 선택합니다.</td></tr>
<tr>
<td>원본 데이터베이스 리전</td><td>원본 데이터베이스 A 리전을 선택합니다.</td></tr>
<tr>
<td>대상 데이터베이스 유형</td><td>MySQL(TencentDB for MySQL 및 자체 구축 MySQL 포함)을 선택합니다.</td></tr>
<tr>
<td>대상 데이터베이스 리전</td><td>대상 데이터베이스 C 리전을 선택합니다.</td></tr>
<tr>
<td>동기화 작업 사양</td><td>현재는 표준 버전만 지원됩니다.</td></tr>
</tbody></table>
2. 구매 성공 후 [데이터 동기화 목록](https://console.cloud.tencent.com/dts/replication)으로 돌아가면 새로 생성된 데이터 동기화 작업을 볼 수 있습니다. 사용하기 전에 설정해야 합니다.
3. 데이터 동기화 목록의 **작업** 열에서 **설정**을 클릭하여 동기화 작업 설정 페이지로 들어갑니다.
4. 동기화 작업 설정 페이지에서 원본 인스턴스와 대상 인스턴스를 설정하고 해당 계정 및 비밀번호를 설정한 뒤 연결성 테스트를 하고 **다음 단계**를 클릭합니다.
<table>
<thead><tr><th>설정 항목</th><th>매개변수</th><th>설명</th></tr></thead>
<tbody><tr>
<td rowspan=2 >작업 설정</td>
<td>작업 이름</td>
<td>DTS는 사용자 정의할 수 있는 작업 이름을 자동 생성합니다.</td></tr>
<tr>
<td>실행 모드</td><td>즉시 실행 및 예약 실행이 지원됩니다.</td></tr>
<tr>
<td rowspan=4 >원본 데이터베이스 설정</td>
<td>원본 데이터베이스 유형</td>
<td>구매 시 선택한 TencentDB 인스턴스 유형을 선택하며, 설정 후에는 변경할 수 없습니다.</td></tr>
<tr>
<td>원본 데이터베이스 리전</td>
<td>구매 시 선택한 TencentDB 인스턴스 A 리전을 선택하며, 설정 후에는 변경할 수 없습니다.</td></tr>
<tr>
<td>서비스 공급자</td>
<td>기타(TencentDB for MySQL 및 자체 구축 MySQL 포함), AWS 및 Alibaba Cloud가 지원됩니다.</td></tr>
<tr>
<td>액세스 유형</td>
<td>기타 클라우드 공급업체가 서비스 제공자로 선택된 경우 액세스 유형은 공용 네트워크일 수 있습니다. 기타를 서비스 제공자로 선택한 경우 데이터베이스 구축 조건에 따라 접근 방식을 선택해야 합니다.<ul>
    <li>공용 네트워크: 공용 IP를 통해 연결된 자체 구축 데이터베이스.</li>
    <li>CVM 자체 구축: CVM에서 자체 구축한 데이터베이스.</li>
    <li>Direct Connect/VPN 액세스: Direct Connect/VPN 게이트웨이를 통해 연결된 자체 구축 데이터베이스.</li>
    <li>VPC: VPC를 통해 연결된 자체 구축 데이터베이스.</li>
    <li>데이터베이스: TencentDB 데이터베이스.</li>
    <li>CCN: CCN을 통해 연결된 자체 구축 데이터베이스.</li>
    </ul></td></tr>
<tr>
<td rowspan=3>대상 데이터베이스 설정</td>
<td>대상 데이터베이스 유형</td><td>대상 데이터베이스 유형을 선택합니다. 설정 후에는 변경할 수 없습니다.</td></tr>
<tr>
<td>대상 데이터베이스 리전</td><td>대상 데이터베이스 C 리전을 선택합니다. 설정 후에는 변경할 수 없습니다.</td></tr>
<tr>
<td>액세스 유형</td><td>대상 데이터베이스 C의 액세스 유형을 선택합니다.</td></tr>
</tbody></table>
5. 동기화 옵션 및 객체 설정 페이지에서 데이터 초기화, 데이터 동기화 및 객체 동기화 옵션을 설정하고 **저장 후 다음으로 이동**을 클릭합니다.
<table>
<thead><tr><th>설정 항목</th><th>매개변수</th><th>설명</th></tr></thead>
<tbody>
<tr>
<td rowspan=2>데이터 초기화 옵션</td>
<td>초기화 유형</td>
    <td><ul><li>구조 초기화: 원본 데이터베이스의 테이블 구조는 동기화 작업이 실행되기 전에 대상 데이터베이스로 초기화됩니다.</li><li>전체 데이터 초기화: 원본 데이터베이스의 데이터는 동기화 작업이 실행되기 전에 대상 데이터베이스로 초기화됩니다.</li></ul>본문은 구조 초기화+전체 데이터 초기화를 선택합니다.</td></tr>
<tr>
<td>대상이 이미 있는 경우</td>
<td><ul><li>사전 확인 및 오류 보고: 동일한 이름의 테이블이 원본 및 대상 데이터베이스에 모두 있는 경우 오류가 보고되고 작업이 중지됩니다.</li><li>무시 및 실행: 전체 및 증분 데이터가 대상 데이터베이스의 테이블에 직접 추가됩니다.</li></ul>본문은 무시 및 실행을 선택합니다.</td></tr>
<tr>
<td rowspan=2>데이터 동기화 옵션</td>
<td>충돌 해결 방법</td>
<td><ul><li>보고: 데이터 동기화 중 기본 키 충돌이 발견되면 오류가 보고되고 데이터 동기화 작업이 일시 중지됩니다.</li><li>무시: 데이터 동기화 중에 기본 키 충돌이 발견되면 대상 데이터베이스의 기본 키 레코드가 유지됩니다.<li>덮어쓰기: 데이터 동기화 중에 기본 키 충돌이 발견되면 원본 데이터베이스의 기본 키 레코드가 대상 데이터베이스의 기본 키 레코드를 덮어씁니다.</li></ul>필요에 따라 옵션을 선택합니다.</td></tr>
<tr>
<td>SQL 유형</td><td>지원되는 작업: Insert, Update, Delete, DDL.<br>다대일 동기화에서는 최대 하나의 작업에서 DDL을 선택할 수 있습니다. 본문은 작업1에서 DDL을 선택하고 다른 작업은 선택하지 않습니다.</td></tr>
<tr>
<td rowspan=2>동기화 객체 옵션</td>
<td>원본 데이터베이스의 데이터베이스 및 테이블 객체</td><td>동기화할 객체를 선택합니다. 데이터베이스, 테이블 및 뷰를 선택할 수 있습니다.</td></tr>
<tr>
<td>선택한 객체</td><td>선택한 동기화 객체를 표시하며 데이터베이스/테이블 매핑이 지원됩니다.</td></tr>
</tbody></table>
6. 작업 확인 페이지에서 시스템은 먼저 DDL 구성을 확인한 다음 원본 및 대상 데이터베이스 매개변수를 확인합니다. 모든 확인 항목이 통과된 후 **작업 시작**을 클릭합니다.
>?
>- 확인이 실패한 경우 [확인 실패 수정](https://cloud.tencent.com/document/product/571/58685) 설명 대로 문제를 수정하고 확인 작업을 다시 시작합니다.
>- 확인 결과에 알람이 표시되면 작업 시작에 영향을 미치지 않지만 **세부 정보 보기**를 클릭하여 조정 제안을 받는 것이 좋습니다. 
>
 - DDL 확인
 - 원본 및 대상 데이터베이스 매개변수 확인
7. 데이터 동기화 작업 리스트로 돌아가면 작업이 **실행 중** 상태가 됩니다.

### 동기화 작업2 생성(데이터베이스 B > 데이터베이스 C)
이전 동기화 작업이 **증분 동기화** 단계에 들어간 후 동기화 작업2를 구성합니다.
작업1과 작업2의 작업은 기본적으로 동일합니다. 다음은 차이점만 설명합니다.

1. 동기화 원본 및 대상 데이터베이스를 설정합니다.
원본 및 대상 데이터베이스 설정에 각각 데이터베이스 A 및 B의 정보를 입력합니다.
2. 동기화 옵션 및 객체를 설정합니다.
  - 초기화 유형: 전체 데이터 초기화만 선택하고 구조 초기화는 선택하지 않습니다.
  - 대상이 이미 있는 경우: 무시 및 실행을 선택합니다.
  - 갈등 해결 방법: 필요에 따라 옵션을 선택합니다.
  - SQL 유형: DDL을 선택하지 마십시오. 다대일 동기화에서는 최대 하나의 작업에서 DDL을 선택할 수 있습니다. 본문은 작업1에서 DDL을 선택하고 다른 작업은 선택하지 않습니다.

### 동기화 작업 중지
동기화 작업이 더 이상 필요하지 않은 경우 **작업** 열에서 **더보기** > **중지**를 선택하여 중지할 수 있습니다.

