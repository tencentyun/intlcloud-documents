
## 概要
TencentDB for MySQLは、ユーザーによる1つまたは複数の読み取り専用インスタンスが構成する読み取り専用インスタンスROグループの作成をサポートし、読み取り/書き込み分離と1つのマスターと複数のスレーブのユースケースに適用することで、ユーザーデータベースの読み取り負荷能力を明らかに向上させることができます。

ROグループは読み取り専用インスタンスの集合であり、1つのROグループが1つのアドレスを共有し、同時にその中の読み取り専用インスタンスの重み付けによるトラフィックのロードバランシングの設定や、遅延の排除設定などを行うことができます。ユーザーは必要に応じてROグループをデプロイし、対応する読み取りリクエストを一定のルールによって読み取り専用インスタンスに送信することができます。同一のROグループ内に複数の読み取り専用インスタンスを配置することで、障害復旧の役割を果たすことができます。

##  前提条件
- 読み取り専用インスタンスを作成する前に、クラウドデータベースマスターインスタンスを作成する必要があります。詳細については、[購入ガイドライン](https://intl.cloud.tencent.com/document/product/236/5160)をご参照ください。
- TencentDB for MySQLを使用する前に、データベースを初期化する必要があります。 [MySQLデータベースの初期化](/doc/product/236/3128)をご参照ください。

## 操作手順
### 読み取り専用インスタンスROグループの作成
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb/ )にログインし、インスタンスリストのインスタンスIDまたは**操作**列の**管理**をクリックし、インスタンス管理ページに進みます。
2. インスタンス詳細ページで、**インスタンスアーキテクチャ図**中の**読み取り専用インスタンスの追加**をクリックするか、または読み取り専用インスタンスページで、**新規作成**をクリックして、購入ページに進みます。
![](https://qcloudimg.tencent-cloud.cn/raw/99c706248d79daad89ec2ba14dd85eee.png)
![](https://qcloudimg.tencent-cloud.cn/raw/c4f55da8d715d578c9a4041ee232bef8.png)
3. 購入ページで、読み取り専用インスタンスに対応する設定を選択し、間違いないことを確認してから、**今すぐ購入**をクリックします。
 - **ROグループの指定**：**ROグループの新規作成**を選択します。1回で複数のインスタンスを購入した場合、すべてこのROグループに割り当てられます。重みの割り当て方法は、デフォルトでシステム自動割り当てになります
 - **ROグループ名の設定**：ROグループ名は一意である必要はありません。長さが60未満の中国語、英語、数字、「-」、「_」、「.」をサポートします。
 - **遅延・超過の排除**：排除ポリシーを起動するかどうかです。排除されたインスタンスの重みは自動的に0に設定されます。
 読み取り専用インスタンスの遅延がしきい値を超えて排除された場合、ユーザーにアラームが出され（読み取り専用インスタンス排除アラームと受信対象の設定については、[アラーム機能](https://intl.cloud.tencent.com/document/product/236/8457)をご参照ください）、またインスタンス状態がサービス停止同期中は、重みが0になります。読み取り専用インスタンスの遅延時間がしきい値未満の時、再度ROグループに入ります。
 同時に、インスタンスが遅延・超過の排除機能を有効化しているかどうかに関わらず、読み取り専用インスタンスの障害が排除された後、インスタンスが修復されるのを待って再度ROグループに入ります。
 - **遅延しきい値**：読み取り専用インスタンスに設定する遅延・超過しきい値。しきい値を超えた読み取り専用インスタンスはROグループから排除されます。
 - **最小保留インスタンス数**：グループ内で保証する必要のあるインスタンスの下限数。既存の読み取り専用インスタンス数がこの下限以下であり、かつ遅延時間がしきい値を超えた場合、既存の読み取り専用インスタンスはいずれも排除されません。
 - **読み取り重みの割り当て**：システムが自動的に割り当てます。
 - **課金モード**：読み取り専用インスタンスは現在、従量課金の課金モードをサポートします。
![](https://main.qcloudimg.com/raw/a8f80ce3f01cbaa1847978bec455aa0d.png)
 - **リージョン**：デフォルトはマスターインスタンスと同じですが、現時点で選択はサポートされていません。
 - **データベースバージョン**：デフォルトはマスターインスタンスのバージョンと同じです。
 - **アーキテクチャ**：シングルノード用です。シングルノードアーキテクチャはコストパフォーマンスが高いですが、単一の読み取り専用インスタンスにはシングルポイントリスクが存在します。可用性を必要とするビジネスROグループの場合は、可用性を確保するために、少なくとも2つの読み取り専用インスタンスを購入することをお勧めします。
 - **データレプリケーション方法**：デフォルトはマスターインスタンスと同じです。
 - **アベイラビリティーゾーン**：このリージョンに複数のアベイラビリティーゾーンがある場合、読み取り専用インスタンスはアベイラビリティーゾーンを選択できます。
>?同じリージョン内のアベイラビリティーゾーン間のネットワーク遅延は数ミリ秒程度で、異なるリージョンとのネットワーク遅延は数十ミリ秒程度、中国本土以外のリージョンでは最大100ミリ秒以上となる可能性があるため、慎重に選択する必要があります。
5. インスタンスリストに戻ると、作成されたインスタンスのステータスは**出荷中**になっています。ステータスが**実行中**に切り換わると、読み取り専用インスタンスの作成が成功したことを表わします。

### 読み取り専用インスタンスROグループの設定
読み取り専用インスタンスROグループの設定インターフェースで、読み取り専用インスタンスROグループID、名前、インスタンスの遅延レプリケーション、遅延時間、インスタンスの遅延・超過の排除、遅延しきい値、最小保留インスタンス、読み取りの重みなどの基本情報を設定することができます。
>?
>- ROグループ内の読み取り専用インスタンスは異なる仕様を使用することができ、トラフィック読み取りの重みを設定することができます。
>- 同一ROグループ内の読み取り専用インスタンスは、異なる有効期限と課金方式をサポートすることできます。
>- 遅延レプリケーションを起動すると、ROグループ内のすべてのROインスタンスが有効になりますが、ROインスタンスのレプリケーションステータスは変わりません。
>- 遅延時間のオプションは、遅延レプリケーションが起動しているときのみ表示されます。
>
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb/ )にログインし、インスタンスリストでマスターインスタンスIDをクリックして、インスタンス管理ページに進みます。
2. インスタンス管理ページで、**読み取り専用インスタンス**ページを選択し、ROグループリストで**設定**をクリックし、ROグループ設定ページに進みます。
![](https://main.qcloudimg.com/raw/f03a6fc7e5460181e1e933157b4922cb.png)
3. ROグループ設定ページで、ROグループの情報を設定し、**OK**をクリックします。
   - **インスタンス遅延レプリケーション**：遅延レプリケーションを設定し、遅延中に指定された時間またはGTID（グローバルトランザクション識別子）へのリカバリの開始を選択することで、データの効率的なロールバックと障害の高速バックトラッキングを実現できます。
   - **遅延時間**：読み取り専用インスタンスとマスターインスタンス間の遅延レプリケーション時間です。設定可能範囲：1～259200秒。
   - **インスタンスの遅延・超過の排除**：排除ポリシーを起動するかどうかです。排除されたインスタンスの重みは自動的に0に設定されます。読み取り専用インスタンスの遅延がしきい値を超えて排除されると、ユーザーにアラートが出されます。読み取り専用インスタンス排除アラートと受信対象の設定については、[アラート機能](https://intl.cloud.tencent.com/document/product/236/8457)をご参照ください。
   - **遅延しきい値**：読み取り専用インスタンスに設定する遅延・超過しきい値。しきい値を超えた読み取り専用インスタンスはROグループから排除されます。
   - **最小保留インスタンス数**：グループ内で保証する必要のあるインスタンスの下限数。既存の読み取り専用インスタンス数がこの下限以下であり、かつ遅延時間がしきい値を超えた場合、既存の読み取り専用インスタンスはいずれも排除されません。
   - **読み取りの重みの割り当て**：ROグループはシステムによる重みの自動割り当てと重みのカスタマイズの2種類の重み設定方法をサポートします。重み入力範囲は0～100で、整数でなければなりません。システムが自動割り当てする2ノード、3ノードMySQLインスタンスの読み取り重みリスト：
<table>
<thead><tr>
<th>インスタンスメモリ仕様(MB)</th>
<th>1000</th><th>2000</th><th>4000</th><th>8000</th><th>12000</th><th>16000</th><th>24000</th><th>32000</th><th>48000</th><th>64000</th><th>96000</th><th>128000</th><th>244000</th><th>488000</th>
</tr></thead>
<tbody><tr>
<td>重み</td>
<td>1</td><td>1</td><td>2</td><td>2</td><td>4</td><td>4</td><td>8</td><td>8</td><td>10</td><td>12</td><td>14</td><td>16</td><td>26</td><td>50</td></tr>
</tbody></table>
 - **リロードバランシング**：
    - リロードバランシングを停止した時は、重みを修正した時に追加の負荷に対してのみ反映され、元の長時間接続がアクセスする読み取り専用インスタンスは変更されず、データベースの瞬断を引き起こすことがありません。
    - リロードバランシングを有効化した時は、データベースが数秒間瞬断されることにより、すべての接続が切断されます。新規の接続は設定された重みに従い負荷のバランスをとります。
<img src="https://main.qcloudimg.com/raw/94a42aa7ed813d8ba68560c40749998f.png"  style="zoom:55%;">


### 読み取り専用インスタンスROグループの破棄と削除
>?
>
>- ROグループは手動による削除機能を提供していません。
- ROグループはグループ内の最後の読み取り専用インスタンスの完全破棄に従って、自動的に削除されます。
- ブランクのROグループの保留をサポートしていません。
>
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb/ )にログインし、インスタンスリストでマスターインスタンスIDをクリックして、インスタンス管理ページに進みます。
2. インスタンス管理ページで、**読み取り専用インスタンス**ページを選択し、右側の**操作**列で**破棄/返却**をクリックします。
![](https://qcloudimg.tencent-cloud.cn/raw/ef06e1a956370519e0c0b652b8a07c72.png)
3. ポップアップしたダイアログボックスで、**破棄ルール**を読み、同意して、**今すぐ破棄**をクリックします。

